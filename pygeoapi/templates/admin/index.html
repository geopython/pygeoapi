
{% extends "_base.html" %}
{% block title %}{{ super() }} Admin {% endblock %}

{% block extrahead %}
<link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
{% endblock %}

{% macro render_block(_key, _val, i) %}
{% if i == 2 %}
  <v-btn
  class="mt-12"
  @click="overlay = !overlay"
  >
    Expand
  </v-btn>
  {{ return }}

{% else %}
    <v-card
     tile
     hover
     @click.stop="dialog = true"
    >
    {% if data.isdict(_val) %}
      <table> 
        <tbody>
          {% for k, v in _val.items() %}
          <tr>
            <th> {{ k }} </th>
            <td>
              {% if data.isdict(v) %}
                {{ render_block(k, v, i+1)}}
              {% elif data.islist(v) %}
                  {{ render_block(0, v, i+1) }}
              {% else %}
                {{ v }}
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}

    </v-card>
    {% endif %}
{% endmacro %}

{% block main %}
  <div id="app" data-app>
    <v-main>
      <v-container>
        <v-tabs v-model="tab">
          <v-tab
            v-for="(val, key) in config"
            grow
            :key="key"
          >
            [[ key ]]
          </v-tab>
        </v-tabs>
        <v-spacer></v-spacer>
        <v-tabs-items v-model="tab">
          <v-tab-item
            v-for="(val, key) in config"
            :key="key"
          >
            <v-card>
              <gui-block :vals="val" depth=0> </gui-block>
            </v-card>  
          </v-tab-item>
        </v-tabs-items>
      </v-container>
    </v-main>


    <template>
      <v-row justify="center">
        <v-dialog
          v-model="dialog"
          persistent
          max-width="600px"
        >
          <v-card>
            <v-card-title>
              <span class="text-h5">User Profile</span>
            </v-card-title>
            <v-card-text>
              <v-container>
                <v-row>
                  <v-col>
                    <v-text-field
                      label="Legal first name*"
                      required
                    ></v-text-field>
                  </v-col>
                  <v-col>
                    <v-text-field
                      label="Legal middle name"
                      hint="example of helper text only on focus"
                    ></v-text-field>
                  </v-col>
                  <v-col
                    cols="12"
                    sm="6"
                    md="4"
                  >
                    <v-text-field
                      label="Legal last name*"
                      hint="example of persistent helper text"
                      persistent-hint
                      required
                    ></v-text-field>
                  </v-col>
                  <v-col cols="12">
                    <v-text-field
                      label="Email*"
                      required
                    ></v-text-field>
                  </v-col>
                  <v-col cols="12">
                    <v-text-field
                      label="Password*"
                      type="password"
                      required
                    ></v-text-field>
                  </v-col>
                  <v-col
                    cols="12"
                    sm="6"
                  >
                    <v-select
                      :items="['0-17', '18-29', '30-54', '54+']"
                      label="Age*"
                      required
                    ></v-select>
                  </v-col>
                  <v-col
                    cols="12"
                    sm="6"
                  >
                    <v-autocomplete
                      :items="['Skiing', 'Ice hockey', 'Soccer', 'Basketball', 'Hockey', 'Reading', 'Writing', 'Coding', 'Basejump']"
                      label="Interests"
                      multiple
                    ></v-autocomplete>
                  </v-col>
                </v-row>
              </v-container>
              <small>*indicates required field</small>
            </v-card-text>
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn
                color="blue darken-1"
                text
                @click="dialog = false"
              >
                Close
              </v-btn>
              <v-btn
                color="blue darken-1"
                text
                @click="dialog = false"
              >
                Save
              </v-btn>
            </v-card-actions>
          </v-card>
        </v-dialog>
      </v-row>
    </template>
  </div>
{% endblock %}

{% block foot %}
{% endblock %}

{% block extrafoot %}
<script type="text/x-template" id="gui-block-template">
  <div class="gui-block">
    <v-container v-if="depth < 2">
    <table> 
      <tbody>
        <tr 
        v-for="(v, k) in vals"
        :key="k">
          <th> 
            <span v-html="k"></span>
          </th>
          <td>
            <span v-html="v"></span>
              <gui-block :vals="v" :depth="depth += 1"></gui-block>
          </td>
        </tr>
      </tbody>
    </table>
  </v-container>
  <v-container v-else>
    <v-btn
      color="blue darken-1"
      text
      @click="dialog = false"
    >
      Expand
      [[ depth ]]
    </v-btn>
  </v-container>
  </div>
</script>

<script> 
  Vue.component('gui-block', {
    props: ['vals', 'depth'],
    name: 'gui-block',
    template: '#gui-block-template'
  })
</script>

<script>
  const vue = new Vue({
    el: '#app',
    vuetify: new Vuetify(),
    delimiters: ['[[', ']]'],
    data: function () {
      return {
        tab: null,
        val: null,
        config: {{ to_json(config) }},
        absolute: true,
        dialog: false,
      }
    },
  })
</script>
{% endblock %}