openapi: 3.0.2
info:
  title: IndoorGML/IndoorJSON API
  version: '1.0'
  description: |-
    An OGC-compliant API for managing IndoorGML 2.0 models using IndoorJSON.
    Optimized for documentation clarity and OGC Features compliance.
servers:
  - url: https://localhost:5000
paths:
  /collections:
    post:
      summary: Register metadata about a collection for indoor features
      description: |
        Creates a new collection to manage indoor features.

        **Configuration Note:**
        This endpoint requires the `itemType` field to specify the content type. For indoor feature collections, you must set `itemType` to `indoorfeature`.
      tags:
        - IndoorFeatureCollection
      operationId: createCollection
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/collections_post'
            example:
              id: aist_waterfront_lab
              title: AIST Waterfront Lab IndoorGML
              description: Experimental IndoorGML data for AIST project
              itemType: indoorfeature
      responses:
        '201':
          description: Successfully created a collection to manage indoor features.
          headers:
            Location:
              description: The URI of the newly created collection.
              schema:
                type: string
                example: https://data.example.org/collections/tokyo_odaiba
        '409':
          $ref: '#/components/responses/conflictError'
        '500':
          $ref: '#/components/responses/internalServerError'
    get:
      summary: Retrieve catalogs of indoor feature collections
      description: |
        Retrieves the list of all feature collections.
        Indoor feature collections are notated "indoorfeature" in the `itemType` field of each collection.
      tags:
        - IndoorFeatureCollection
      operationId: getCollections
      responses:
        '200':
          $ref: '#/components/responses/collections'
        '401':
          $ref: '#/components/responses/unauthorized'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}:
    parameters:
      - $ref: '#/components/parameters/collectionId'
    get:
      summary: Access metadata about the collection
      description: |
        A user can access metadata with id `collectionId`.
      tags:
        - IndoorFeatureCollection
      operationId: getCollection
      responses:
        '200':
          $ref: '#/components/responses/collection'
        '401':
          $ref: '#/components/responses/unauthorized'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
    patch:
      summary: Replace metadata about the collection
      description: |
        A user SHOULD replace metadata with `collectionId`.
        The request body schema is the same as the POST's.
        Only the `title` and `description` fields can be modified.
      tags:
        - IndoorFeatureCollection
      operationId: updateCollection
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: New human-readable title for the collection.
                description:
                  type: string
                  description: New description for the collection.
            example:
              title: Updated Indoor Feature Collection Title
              description: This is the updated description for the indoor feature collection.
      responses:
        '200':
          $ref: '#/components/responses/collection'
        '400':
          $ref: '#/components/responses/badRequest'
        '401':
          $ref: '#/components/responses/unauthorized'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
    delete:
      summary: Deletes a collection
      description: |
        The collection catalog with id 'collectionId' including metadata and indoor features SHOULD be deleted.
      tags:
        - IndoorFeatureCollection
      operationId: deleteCollection
      responses:
        '204':
          $ref: '#/components/responses/noContent'
        '401':
          $ref: '#/components/responses/unauthorized'
        '403':
          $ref: '#/components/responses/forbidden'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items:
    parameters:
      - $ref: '#/components/parameters/collectionId'
    post:
      summary: Insert indoor features
      description: |
        A user SHOULD insert a set of indoor features or an indoor feature into a collection with id `collectionId`.
        The request body schema SHALL follow the IndoorJSON schema.
        While the InterLayerConnection and Primal, Dual Spaces are not essential in a IndoorFeature's existence, it must have at least one ThematicLayer.
      tags:
        - IndoorFeatures
      operationId: createItem
      parameters:
        - $ref: '#/components/parameters/geoJSONBbox'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/indoorJSON'
            example:
              featureType: IndoorFeatures
              id: AIST_Waterfront_Center
              geometry:
                type: Point
                coordinates:
                  - 125.6
                  - 10.1
              properties: {}
              layers:
                - id: TL-1
                  featureType: ThematicLayer
                  semanticExtension: false
                  theme: Physical
                  primalSpace:
                    id: PS-1
                    featureType: PrimalSpaceLayer
                    creationDatetime: '2025-10-30T13:00:00'
                    cellSpaceMember:
                      - id: C1
                        featureType: CellSpace
                        duality: TL-1:DS-1:N1
                        poi: false
                        level: '1'
                        cellSpaceGeom:
                          geometry2D:
                            type: Polygon
                            coordinates:
                              - - - 0
                                  - 0
                                - - 2
                                  - 0
                                - - 2
                                  - 2
                                - - 0
                                  - 2
                                - - 0
                                  - 0
                        boundedBy:
                          - TL-1:PS-1:B1
                      - id: C2
                        featureType: CellSpace
                        duality: TL-1:DS-1:N2
                        poi: false
                        level: '1'
                        cellSpaceGeom:
                          geometry2D:
                            type: Polygon
                            coordinates:
                              - - - 2
                                  - 0
                                - - 4
                                  - 0
                                - - 4
                                  - 2
                                - - 2
                                  - 2
                                - - 2
                                  - 0
                        boundedBy: []
                    cellBoundaryMember:
                      - id: B1
                        featureType: CellBoundary
                        isVirtual: false
                        duality: TL-1:DS-1:E1
                        cellBoundaryGeom:
                          geometry2D:
                            type: LineString
                            coordinates:
                              - - 2
                                - 0
                              - - 2
                                - 2
                  dualSpace:
                    id: DS-1
                    featureType: DualSpaceLayer
                    creationDatetime: '2025-10-30T13:00:00'
                    isLogical: false
                    isDirected: false
                    nodeMember:
                      - id: N1
                        featureType: Node
                        duality: TL-1:PS-1:C1
                        geometry:
                          type: Point
                          coordinates:
                            - 1
                            - 1
                        connects:
                          - TL-1:DS-1:E1
                      - id: N2
                        featureType: Node
                        duality: C2
                        geometry:
                          type: Point
                          coordinates:
                            - 3
                            - 1
                        connects:
                          - E1
                    edgeMember:
                      - id: E1
                        featureType: Edge
                        duality: B1
                        weight: 1
                        geometry:
                          type: LineString
                          coordinates:
                            - - 1
                              - 1
                            - - 3
                              - 1
                        connects:
                          - TL-1:DS-1:N1
                          - TL-1:DS-1:N2
      responses:
        '201':
          description: Successfully created an indoorFeature into a specific collection.
        '400':
          $ref: '#/components/responses/badRequest'
        '404':
          $ref: '#/components/responses/notFound'
        '413':
          $ref: '#/components/responses/payloadTooLarge'
        '422':
          $ref: '#/components/responses/unprocessableEntity'
        '500':
          $ref: '#/components/responses/internalServerError'
    get:
      tags:
        - IndoorFeatures
      summary: Retrieve indoor feature collection
      operationId: getIndoorFeatures
      parameters:
        - $ref: '#/components/parameters/limit'
        - $ref: '#/components/parameters/bbox'
      responses:
        '200':
          schema: null
          $ref: '#/components/responses/features'
          example:
            $ref: ./examples/indoorFeatures.json
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
    get:
      tags:
        - IndoorFeatures
      summary: fetch a single indoor feature
      description: |-
        Retrieves a single IndoorFeature.

        **Logic:** If both `bbox` and `level` are provided, the server returns an `IndoorFeature` with the primalSpace filtered. 
        If both are not provided, only the metadata within the properties is returned.
      operationId: getFeature
      parameters:
        - $ref: '#/components/parameters/bbox'
        - $ref: '#/components/parameters/level'
      responses:
        '200':
          description: Success. Returns a GeoJSON Feature representing the IndoorGML model.
          content:
            application/geo+json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/featureGeoJSON'
                  - $ref: '#/components/schemas/metaGeoJSON'
              examples:
                indoorFeature:
                  $ref: '#/components/examples/indoorFeature'
        '400':
          $ref: '#/components/responses/badRequest'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
    delete:
      tags:
        - IndoorFeatures
      summary: delete an indoor feature
      description: |-
        Permanently removes the specified indoor feature. 

        **Cascading Delete:** All associated ThematicLayers and InterLayerConnections 
        belonging to this feature ID will be removed.
      operationId: deleteFeature
      responses:
        '204':
          $ref: '#/components/responses/noContent'
        '401':
          $ref: '#/components/responses/unauthorized'
        '403':
          $ref: '#/components/responses/forbidden'
        '404':
          $ref: '#/components/responses/notFound'
  /collections/{collectionId}/items/{featureId}/layers:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
    post:
      tags:
        - ThematicLayers
      summary: register a new thematic layer
      description: |-
        Uploads a new thematic layer (e.g., 'Pet-friendly' or 'Furnitures') to a specific `featureId`.
        The body must conform to the IndoorJSON ThematicLayer schema.

        The `Id`s of the members in each primalSpace and dualSpace must be unique within the layer.
        Thus, a `cellSpace` can have the same `Id` as a `node` or `edge` even in the same ThematicLayer.
        (It is recommended to use a consistent naming convention to avoid confusion between them)
      operationId: createThematicLayer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/thematicLayer'
            example:
              id: layer-indoor-nav-f1
              featureType: ThematicLayer
              semanticExtension: true
              theme: Virtual
              primalSpace:
                id: primal-space-f1
                featureType: PrimalSpaceLayer
                creationDatetime: '2024-01-16T15:00:00Z'
                cellSpaceMember:
                  - id: cell-room-101
                    featureType: CellSpace
                    cellSpaceName: Server Room
                    level: 1F
                    poi: true
                    duality: node-101
                    cellSpaceGeom:
                      geometry2D:
                        type: Polygon
                        coordinates:
                          - - - 0
                              - 0
                            - - 10
                              - 0
                            - - 10
                              - 10
                            - - 0
                              - 10
                            - - 0
                              - 0
                    boundedBy:
                      - boundary-wall-01
                  - id: cell-corridor-100
                    featureType: CellSpace
                    cellSpaceName: Main Corridor
                    level: 1F
                    poi: false
                    duality: node-100
                    cellSpaceGeom:
                      geometry2D:
                        type: Polygon
                        coordinates:
                          - - - 10
                              - 0
                            - - 20
                              - 0
                            - - 20
                              - 10
                            - - 10
                              - 10
                            - - 10
                              - 0
                cellBoundaryMember:
                  - id: boundary-wall-01
                    featureType: CellBoundary
                    isVirtual: true
                    duality: edge-101-100
                    cellBoundaryGeom:
                      geometry2D:
                        type: LineString
                        coordinates:
                          - - 10
                            - 2
                          - - 10
                            - 8
              dualSpace:
                id: dual-space-f1
                featureType: DualSpaceLayer
                isLogical: true
                isDirected: true
                nodeMember:
                  - id: node-101
                    featureType: Node
                    duality: cell-room-101
                    geometry:
                      type: Point
                      coordinates:
                        - 5
                        - 5
                    connects:
                      - edge-101-100
                  - id: node-100
                    featureType: Node
                    duality: cell-corridor-100
                    geometry:
                      type: Point
                      coordinates:
                        - 15
                        - 5
                    connects:
                      - edge-101-100
                edgeMember:
                  - id: edge-101-100
                    featureType: Edge
                    weight: 1.5
                    duality: boundary-wall-01
                    connects:
                      - node-101
                      - node-100
                    geometry:
                      type: LineString
                      coordinates:
                        - - 5
                          - 5
                        - - 15
                          - 5
      responses:
        '201':
          description: Success. The layer was validated and stored.
          headers:
            Location:
              description: URL to the newly created thematic layer.
              schema:
                type: string
        '400':
          $ref: '#/components/responses/badRequest'
        '404':
          $ref: '#/components/responses/notFound'
        '409':
          $ref: '#/components/responses/conflictError'
        '422':
          $ref: '#/components/responses/unprocessableEntity'
    get:
      tags:
        - ThematicLayers
      summary: retrieve all thematic layers
      description: |-
        Returns a summary list (metaData) of all (filtered) thematic layers within the specified indoor feature.
        Without the level parameter, it would show all the thematic layers.
      operationId: getThematicLayers
      parameters:
        - $ref: '#/components/parameters/limit'
        - $ref: '#/components/parameters/theme'
        - $ref: '#/components/parameters/level'
      responses:
        '200':
          description: A JSON object containing level information and a list of thematicLayers including those level(s).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/thematicLayerList'
              example:
                levels:
                  - '1'
                  - 1F
                layers:
                  - id: layer-indoor-nav-f1
                    featureType: ThematicLayer
                    semanticExtension: true
                    theme: virtual
                    levels:
                      - 1F
                    links:
                      - href: http://localhost:5000/collections/aist_waterfront_lab/items/AIST_Waterfront_Center/layers/layer-indoor-nav-f1
                        rel: item
                        type: application/json
                        title: Layer Detail
                links:
                  - href: http://localhost:5000/collections/aist_waterfront_lab/items/AIST_Waterfront_Center/layers?limit=10&level=1F&offset=0
                    rel: self
                    type: application/json
                    title: Thematic Layers
        '400':
          $ref: '#/components/responses/badRequest'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}}/interlayerconnections:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
    post:
      tags:
        - InterLayerConnections
      summary: create an inter-layer connection
      description: |-
        Creates a new inter-layer connection between two thematic layers within the same IndoorFeature.
        When connectedNodes and connectedCells are given simultaneously, the two cellSpaces and Nodes must have duality relationships.
        Also the given Ids should all be pre-existing.
      operationId: createInterLayerConnection
      requestBody:
        description: The InterLayerConnection object to be created.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/interLayerConnection'
            example:
              featureType: InterLayerConnection
              id: conn_physical_to_virtual_01
              connectedLayers:
                - TL-1
                - layer-indoor-nav-f1
              typeOfTopoExpression: equals
              connectedNodes:
                - N1
                - node-101
              comment: Connecting physical node N1 to virtual node 101
      responses:
        '201':
          description: Created successfully.
        '400':
          description: Bad Request (Missing fields or array length != 2).
        '404':
          $ref: '#/components/responses/notFound'
        '422':
          $ref: '#/components/responses/unprocessableEntity'
    get:
      tags:
        - InterLayerConnections
      summary: retrieve inter-layer connections
      description: Returns all inter-layer connections, with optional filtering by layer or topological Expression.
      operationId: getInterLayerConnections
      parameters:
        - $ref: '#/components/parameters/connectedLayerId'
        - $ref: '#/components/parameters/typeOfTopoExpression'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: Successfully retrieved list of connection(s).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/interLayerConnections'
              example:
                layerConnections:
                  - id: conn_physical_to_virtual_01
                    featureType: InterLayerConnection
                    typeOfTopoExpression: equals
                    comment: Connecting physical node N1 to virtual node 101
                    connectedLayers:
                      - TL-1
                      - layer-indoor-nav-f1
                    connectedNodes:
                      - N1
                      - node-101
                    connectedCells: []
                links:
                  - href: http://localhost:5000/collections/aist_waterfront_lab/items/AIST_Waterfront_Center/interlayerconnections?limit=10&connectedLayerId=TL-1&offset=0
                    rel: self
                    type: application/json
                    title: Current Page
        '400':
          $ref: '#/components/responses/badRequest'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}/interlayerconnections/{cnId}:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
      - $ref: '#/components/parameters/cnId'
    delete:
      tags:
        - InterLayerConnections
      summary: delete a specific inter-layer connection
      description: Deletes the specific inter-layer connection identified by connectionId.
      operationId: deleteInterLayerConnection
      responses:
        '204':
          $ref: '#/components/responses/noContent'
        '401':
          $ref: '#/components/responses/unauthorized'
        '403':
          $ref: '#/components/responses/forbidden'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}/layers/{tId}:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
      - $ref: '#/components/parameters/tId'
    get:
      tags:
        - ThematicLayers
      summary: Retrieve a specific thematic layer
      description: |-
        Returns metadata summary if no filters are provided.  Returns full Primal/Dual features if 'level' or 'bbox' is present.
        As the property 'level' is only available for `cellSpaces`, for `cellBoundaries` they will be inferred through `boundedBy`. The 'dualSpace' will be returned non-filtered.
      operationId: getThematicLayer
      parameters:
        - $ref: '#/components/parameters/level'
        - $ref: '#/components/parameters/bbox'
      responses:
        '200':
          description: Successfully retrieved a single thematic layer.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/thematicLayerSummary'
                  - $ref: '#/components/schemas/thematicLayer'
        '400':
          $ref: '#/components/responses/badRequest'
        '401':
          $ref: '#/components/responses/unauthorized'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
    delete:
      tags:
        - ThematicLayers
      summary: Delete a thematic layer
      description: Permanently removes the layer and all its internal elements.  Automatically cleans up any `InterLayerConnections` pointing to this layer to prevent broken links.
      operationId: deleteThematicLayer
      responses:
        '204':
          $ref: '#/components/responses/noContent'
        '401':
          $ref: '#/components/responses/unauthorized'
        '403':
          $ref: '#/components/responses/forbidden'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}/layers/{tId}/primal:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
      - $ref: '#/components/parameters/tId'
    get:
      tags:
        - PrimalSpaceLayer
      summary: retrieve primal space members
      description: |-
        Retrieves a collection of CellSpaces and CellBoundaries within a specific thematic layer. 
        Supports spatial filtering via `bbox`, `level` and logical filtering via `poi`/`isVirtual`.
      operationId: getPrimalSpace
      parameters:
        - $ref: '#/components/parameters/bbox'
        - $ref: '#/components/parameters/level'
        - $ref: '#/components/parameters/poi'
        - $ref: '#/components/parameters/isVirtual'
        - $ref: '#/components/parameters/cellSpaceName'
      responses:
        '200':
          description: Success. Returns the PrimalSpaceLayer.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/primalSpaceLayer'
              example:
                id: primal-space-f1
                featureType: PrimalSpaceLayer
                creationDatetime: '2024-01-16T15:00:00'
                terminationDatetime: null
                cellSpaceMember:
                  - id: cell-room-101
                    featureType: CellSpace
                    cellSpaceName: Server Room
                    level: 1F
                    poi: true
                    duality: node-101
                    cellSpaceGeom:
                      geometry2D:
                        type: Polygon
                        coordinates:
                          - - - 0
                              - 0
                            - - 10
                              - 0
                            - - 10
                              - 10
                            - - 0
                              - 10
                            - - 0
                              - 0
                      geometry3D: null
                    externalReference: null
                    boundedBy:
                      - boundary-wall-01
                cellBoundaryMember:
                  - id: boundary-wall-01
                    featureType: CellBoundary
                    isVirtual: true
                    duality: edge-101-100
                    cellBoundaryGeom:
                      geometry2D:
                        type: LineString
                        coordinates:
                          - - 10
                            - 2
                          - - 10
                            - 8
                      geometry3D: null
                    externalReference: null
                links:
                  - href: http://localhost:5000/collections/aist_waterfront_lab/items/AIST_Waterfront_Center/layers/layer-indoor-nav-f1/primal?cellSpaceName=Room
                    rel: self
                    type: application/json
                    title: Primal Space Layer
        '400':
          $ref: '#/components/responses/badRequest'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
    post:
      tags:
        - PrimalSpaceLayer
      summary: create primal space member
      description: |-
        Create a new `cellSpace` or `cellBoundary`.

        **Constraints:**
        - If a `duality` is provided for a `cellBoundary`, the referenced `edge` must already exist and must not already be linked to another feature.
        - A `cellSpace` cannot have a `duality` link at the moment of creation, as a `node` cannot exist independently without its parent graph.

        **Automatic Updates:**
        - When a `node` is later created with a `duality` link to an existing `cellSpace`, the system automatically updates the `cellSpace` record to reflect this bidirectional relationship.
        - Vice versa, the `edge` record is also updated to include the `cellBoundary` as its duality.
      operationId: createPrimalMember
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/cellSpace'
                - $ref: '#/components/schemas/cellBoundary'
            examples:
              cellSpace:
                summary: Example of a CellSpace
                value:
                  $ref: ./examples/cellSpace.json
              cellBoundary:
                summary: Example of a CellBoundary
                value:
                  $ref: ./examples/cellBoundary.json
      responses:
        '201':
          description: Created successfully.
        '400':
          $ref: '#/components/responses/badRequest'
        '409':
          $ref: '#/components/responses/conflictError'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}/layers/{tId}/dual:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
      - $ref: '#/components/parameters/tId'
    post:
      tags:
        - DualSpaceLayer
      summary: create a dual space member (Node or Edge)
      description: |-
        Registers a new Node or Edge. 

        **Strict Duality Requirement:** A Node can only be created if the corresponding CellSpace (duality) exists. 
        An Edge connects exactly 2 nodes.
      operationId: createDualMember
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/node'
                - $ref: '#/components/schemas/edge'
            examples:
              cellSpace:
                summary: Example of a Node
                value:
                  $ref: ./examples/node.json
              cellBoundary:
                summary: Example of an Edge
                value:
                  $ref: ./examples/edge.json
      responses:
        '201':
          description: Created successfully.
        '400':
          $ref: '#/components/responses/badRequest'
        '401':
          $ref: '#/components/responses/unauthorized'
        '404':
          $ref: '#/components/responses/notFound'
        '409':
          $ref: '#/components/responses/conflictError'
        '422':
          description: Unprocessable Entity (Node missing duality dependency).
        '500':
          $ref: '#/components/responses/internalServerError'
    get:
      tags:
        - DualSpaceLayer
      summary: Retrieve all nodes and edges (Navigation Network)
      description: |-
        Retrieves the dual space layer, optionally filtered by edge weights for pathfinding.
        When filtered by weights, the response includes not only the regarding edges, but also only the connected nodes to those edges.
      operationId: getDualSpace
      parameters:
        - $ref: '#/components/parameters/collectionId'
        - $ref: '#/components/parameters/featureId'
        - $ref: '#/components/parameters/tId'
        - name: minWeight
          in: query
          schema:
            type: number
            minimum: 0
          description: Filter edges where weight > minWeight.
        - name: maxWeight
          in: query
          schema:
            type: number
            minimum: 0
          description: Filter edges where weight < maxWeight.
      responses:
        '200':
          description: Returns the DualSpaceLayer.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/dualSpaceLayer'
        '400':
          $ref: '#/components/responses/badRequest'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}/layers/{tId}/geoquery:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
      - $ref: '#/components/parameters/tId'
    get:
      tags:
        - Services
      summary: Performs a geometric query agains CellSpace geometries
      description: |-
        Performs a spatial query against the **PrimalSpace** of a specific ThematicLayer using 2D geometric predicates.

        **Functionality:**
        This operation filters `CellSpace` geometries based on a provided spatial operator (`op`) and a reference geometry. Unlike a standard bounding box filter, this endpoint supports complex topological predicates (e.g., *intersects*, *contains*, *within*) defined by the OGC Simple Features standard.

        **Spatial Duality Logic:**
        - **Primal Space:** Only the `CellSpaceMember` items that satisfy the geometric predicate are returned.
        - **Dual Space:** The server automatically identifies the `Nodes` (States) corresponding to the filtered CellSpaces via the duality relationship. The resulting `dualSpace` will contain these nodes and any `Edges` (Transitions) that connect them, providing a sub-graph of the indoor navigation network that exists within the queried area.

        **Parameters:**
        - `op`: The geometric predicate to apply (e.g., `intersects`, `disjoint`, `contains`).
        - `geometry`: The reference geometry in WKT (Well-Known Text) format used for the predicate.
        - `level`: (Optional) Restricts the search to a specific floor or vertical level within the IndoorGML model.

        **Response:**
        Returns a single `ThematicLayer` object containing the filtered Primal and Dual space components.
      operationId: geometricQuery
      parameters:
        - $ref: '#/components/parameters/op'
        - $ref: '#/components/parameters/level'
        - $ref: '#/components/parameters/geometry'
      responses:
        '200':
          description: Returns the GeoQueryResults.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/geoQueryResults'
              example:
                id: TL1
                featureType: ThematicLayer
                theme: physical
                semanticExtension: false
                primalSpace:
                  id: m5ffb680-c7aa-7490-e409-1ac27565de55
                  featureType: PrimalSpaceLayer
                  cellSpaceMember:
                    - id: C25
                      featureType: CellSpace
                      duality: S26
                      level: '1'
                      cellSpaceGeom:
                        geometry2D:
                          type: Polygon
                          coordinates:
                            - - - 234.85
                                - 399.78
                              - - 246.48
                                - 399.58
                              - - 287.33
                                - 399.21
                              - - 234.85
                                - 399.78
                        geometry3D:
                          type: Polyhedron
                          coordinates:
                            - - - - 211.94
                                  - 386.64
                                  - 0
                                - - 225.41
                                  - 386.88
                                  - 0
                                - - 211.94
                                  - 386.64
                                  - 0
                dualSpace:
                  id: d7dee6fe-99c8-2489-63fe-52756186bfa2
                  featureType: DualSpaceLayer
                  nodeMember:
                    - id: S1
                      featureType: Node
                      geometry:
                        type: Point
                        coordinates:
                          - 199.8
                          - 391.65
                          - 0
                      duality: C1
                      connects:
                        - T3
                        - T74
                  edgeMember:
                    - id: T1
                      featureType: Edge
                      geometry:
                        type: LineString
                        coordinates:
                          - - 174.12
                            - 536.21
                            - 40
                          - - 174.33
                            - 536.16
                            - 20
                      weight: 1
                      connects:
                        - S5
                        - S4
                links:
                  - href: http://localhost:5000/collections/aist/items/building-1/layers/TL1/geoquery?op=intersects&geometry=POINT(250 350)
                    rel: self
                    type: application/json
                    title: Geometric query result
        '400':
          $ref: '#/components/responses/badRequest'
        '401':
          $ref: '#/components/responses/unauthorized'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}/layers/{tId}/dual/route:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
      - $ref: '#/components/parameters/tId'
    get:
      tags:
        - Services
      summary: Compute an indoor route using the dual graph
      description: |-
        Computes the shortest navigable path between two points within an `IndoorFeature` based on the **Dual Space** graph logic of a specific `ThematicLayer`.

        **Routing Logic:**
        This operation utilizes the **Dijkstra algorithm** (via pgRouting) to traverse the network of `Nodes` (States) and `Edges` (Transitions) defined in the IndoorGML dual graph. It calculates the path with the lowest cumulative weight, where weight typically represents physical distance or travel time.

        **Spatial Awareness:**
        - **Start/Destination:** The `sn` (Start Node) and `dn` (Destination Node) must exist within the specified `ThematicLayer`. 
        - **Segments:** The result returns an ordered sequence of `path_segments`. Each segment represents a **Transition** (Edge) in the graph, except for the final segment which identifies the reached **State** (Node).
        - **Geometry:** Every segment includes GeoJSON geometry derived from the dual space, allowing for immediate visualization of the route on a 2D or 3D map.

        **Duality context:**
        While the route is calculated in the **Dual Space** (the network), the resulting IDs can be used to identify the corresponding **Primal Space** cells (rooms, corridors) that the user will physically pass through, thanks to the IndoorGML duality relationship.

        **Usage Note:**
        If no path exists between the two nodes (e.g., nodes are in disconnected sub-graphs or different buildings), the service returns an empty path with a total cost of zero.
      operationId: computeIndoorRoute
      parameters:
        - $ref: '#/components/parameters/sn'
        - $ref: '#/components/parameters/dn'
      responses:
        '200':
          description: Returns the RouteResults.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/routeResults'
              example:
                type: RouteResult
                start_node: S1
                destination_node: S2
                cost: 0
                path_segments:
                  - seq: 1
                    type: edge
                    id_str: T3
                    cost: 0
                    geometry:
                      type: LineString
                      coordinates:
                        - - 199.80587605206992
                          - 391.6592448986117
                          - 0
                        - - 199.9661492345782
                          - 391.31840285000396
                          - 20
                  - seq: 2
                    type: destination_node
                    id_str: S2
                    cost: 0
                    geometry:
                      type: Point
                      coordinates:
                        - 199.9661492345782
                        - 391.31840285000396
                        - 20
                links:
                  - href: http://localhost:5000/collections/aist_waterfront_lab/items/u64465b1-3012-0c9e-82e4-cf37470411b5/layers/TL1/dual/route?sn=S1&dn=S2
                    rel: self
                    type: application/json
                    title: Indoor Route Result
        '400':
          $ref: '#/components/responses/badRequest'
        '401':
          $ref: '#/components/responses/unauthorized'
        '404':
          $ref: '#/components/responses/notFound'
        '422':
          $ref: '#/components/responses/unprocessableEntity'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}/layers/{tId}/primal/{mId}:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
      - $ref: '#/components/parameters/tId'
      - $ref: '#/components/parameters/mId'
    get:
      tags:
        - PrimalSpaceLayer
      summary: retrieve a specific cell space
      description: |-
        Returns the full representation of a primalSpaceMember.
        If the `mId` refers to a `cellSpace`, it returns the whole cellSpace.
        If the `mId` refers to a `cellBoundary`, it returns the whole cellBoundary.
      operationId: getPrimalMember
      responses:
        '200':
          description: Success. Returns the CellSpace or CellBoundary object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/cellSpace'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
    patch:
      tags:
        - PrimalSpaceLayer
      summary: update cell space metadata
      description: Performs a partial update. Only include the fields you wish to change (cellSpaceName, level, or poi).
      operationId: patchCellSpace
      requestBody:
        content:
          application/merge-patch+json:
            schema:
              $ref: '#/components/schemas/cellSpaceUpdate'
      responses:
        '200':
          description: Success. Returns the updated CellSpace.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/cellSpace'
        '400':
          $ref: '#/components/responses/badRequest'
        '401':
          $ref: '#/components/responses/unauthorized'
        '403':
          $ref: '#/components/responses/forbidden'
        '404':
          $ref: '#/components/responses/notFound'
        '422':
          $ref: '#/components/responses/unprocessableEntity'
    delete:
      tags:
        - PrimalSpaceLayer
      summary: delete a cell space
      description: |-
        Permanently removes the CellSpace. 
        **Cleanup:** This triggers a cascading delete of the associated DualSpace Node and invalidates connected Edges.
        Also DELETES the `interLayerConnection`(s) referencing the deleted `primalSpaceMember`.
      operationId: deleteCellSpace
      responses:
        '204':
          description: Deleted successfully.
        '400':
          $ref: '#/components/responses/badRequest'
        '401':
          $ref: '#/components/responses/unauthorized'
        '403':
          $ref: '#/components/responses/forbidden'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}/layers/{tId}/primal/{mId}/bounding:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
      - $ref: '#/components/parameters/tId'
      - $ref: '#/components/parameters/mId'
    get:
      tags:
        - Services
      summary: Retrieve a CellSpace bounded by a specific CellBoundary
      description: |-
        Retrieves the `CellSpace` (Primal Space) that is physically bounded by the specified `CellBoundary` identifier (`mId`).
        If the `mId` doen't refer to a `cellBoundary`, it returns a 404 error (even for cellSpaces).

        **Topological Logic:**
        In IndoorGML, a `CellBoundary` defines the geometric and semantic limit of a 3D or 2D `CellSpace`. This endpoint performs a reverse-lookup to identify which space is defined by the provided boundary.

        **Spatial Duality Note:**
        While this query occurs in the **Primal Space**, the resulting `CellSpace` contains a `duality` field that allows you to identify the corresponding `Node` (State) in the **Dual Space** for navigation purposes.

        **Usage Context:**
        Useful for identifying rooms or corridors sharing a specific wall, door, or virtual transition.
      operationId: getBoundingCellSpace
      responses:
        '200':
          description: Success. Returns the CellSpace associated with the boundary.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/cellSpace'
        '400':
          $ref: '#/components/responses/badRequest'
        '404':
          $ref: '#/components/responses/notFound'
        '422':
          $ref: '#/components/responses/unprocessableEntity'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}/layers/{tId}/dual/{mId}/connected:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
      - $ref: '#/components/parameters/tId'
      - $ref: '#/components/parameters/mId'
    get:
      tags:
        - Services
      summary: Retrieve  connectively reachable nodes and their duality cellspaces from specific node.
      description: |-
        Retrieves all nodes within the **Dual Space** graph that are topologically reachable from a specific source node within a defined number of "hops" (edges).

        **Connectivity Logic:**
        The service performs a **Recursive Common Table Expression (CTE)** query to traverse the graph. It identifies immediate neighbors (1-hop) and continues to iterate until the specified `hop` limit is reached. 

        **Spatial Duality:**
        For every reachable node found, the response includes its `duality` link, allowing clients to map logical network reachability back to physical `CellSpace` members (rooms or corridors).

        **Use Case:**
        Ideal for calculating service areas, identifying adjacent rooms, or determining the scope of sensor coverage within an indoor environment.
      operationId: getConnectedNodes
      parameters:
        - $ref: '#/components/parameters/limit'
        - $ref: '#/components/parameters/hop'
      responses:
        '200':
          description: Successfully retrieved connected nodes within the specified hop distance.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/connectedResults'
              example:
                type: ConnectedNodesResult
                start_node: S1
                connected_nodes:
                  - hop: 1
                    id: S2
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 199.9661492345782
                        - 391.31840285000396
                        - 20
                    duality: C2
                    connects:
                      - T2
                      - T3
                      - T73
                      - T3-REVERSE
                      - T2-REVERSE
                      - T73-REVERSE
                  - hop: 1
                    id: S33
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 197.20469617671412
                        - 456.67516521145586
                        - 0
                    duality: C31
                    connects:
                      - T45
                      - T46
                      - T47
                      - T48
                      - T49
                      - T50
                      - T51
                      - T52
                      - T53
                      - T54
                      - T55
                      - T56
                      - T57
                      - T74
                      - T45-REVERSE
                      - T46-REVERSE
                      - T47-REVERSE
                      - T48-REVERSE
                      - T49-REVERSE
                      - T50-REVERSE
                      - T51-REVERSE
                      - T52-REVERSE
                      - T53-REVERSE
                      - T54-REVERSE
                      - T55-REVERSE
                      - T56-REVERSE
                      - T57-REVERSE
                      - T74-REVERSE
                  - hop: 2
                    id: S11
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 132.61655036068373
                        - 478.35533039639836
                        - 0
                    duality: C11
                    connects:
                      - T20
                      - T48
                      - T20-REVERSE
                      - T48-REVERSE
                  - hop: 2
                    id: S12
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 132.43060255573644
                        - 450.1206701609353
                        - 0
                    duality: C12
                    connects:
                      - T19
                      - T49
                      - T19-REVERSE
                      - T49-REVERSE
                  - hop: 2
                    id: S15
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 149.47277525671066
                        - 411.51805594230575
                        - 0
                    duality: C15
                    connects:
                      - T16
                      - T17
                      - T18
                      - T19
                      - T50
                      - T16-REVERSE
                      - T17-REVERSE
                      - T18-REVERSE
                      - T19-REVERSE
                      - T50-REVERSE
                  - hop: 2
                    id: S19
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 156.74761885157474
                        - 368.5924452498791
                        - 0
                    duality: C18
                    connects:
                      - T13
                      - T14
                      - T15
                      - T51
                      - T13-REVERSE
                      - T14-REVERSE
                      - T15-REVERSE
                      - T51-REVERSE
                  - hop: 2
                    id: S2
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 199.9661492345782
                        - 391.31840285000396
                        - 20
                    duality: C2
                    connects:
                      - T2
                      - T3
                      - T73
                      - T3-REVERSE
                      - T2-REVERSE
                      - T73-REVERSE
                  - hop: 2
                    id: S23
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 173.7517403488478
                        - 556.5106900796362
                        - 0
                    duality: C22
                    connects:
                      - T47
                      - T47-REVERSE
                  - hop: 2
                    id: S24
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 173.97527995304864
                        - 536.0943016471066
                        - 0
                    duality: C23
                    connects:
                      - T46
                      - T46-REVERSE
                  - hop: 2
                    id: S25
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 218.70737599648717
                        - 353.2492585278638
                        - 0
                    duality: C24
                    connects:
                      - T52
                      - T52-REVERSE
                  - hop: 2
                    id: S26
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 255.00244960999748
                        - 366.63034794233465
                        - 0
                    duality: C25
                    connects:
                      - T53
                      - T53-REVERSE
                  - hop: 2
                    id: S3
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 199.68958053702457
                        - 391.6145570961798
                        - 40
                    duality: C3
                    connects:
                      - T2
                      - T75
                      - T2-REVERSE
                      - T75-REVERSE
                  - hop: 2
                    id: S31
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 253.38771100828393
                        - 541.0478377902552
                        - 0
                    duality: C29
                    connects:
                      - T57
                      - T57-REVERSE
                  - hop: 2
                    id: S32
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 265.147482708762
                        - 429.7209179927447
                        - 0
                    duality: C30
                    connects:
                      - T10
                      - T11
                      - T12
                      - T54
                      - T55
                      - T56
                      - T10-REVERSE
                      - T11-REVERSE
                      - T12-REVERSE
                      - T54-REVERSE
                      - T55-REVERSE
                      - T56-REVERSE
                  - hop: 2
                    id: S33
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 197.20469617671412
                        - 456.67516521145586
                        - 0
                    duality: C31
                    connects:
                      - T45
                      - T46
                      - T47
                      - T48
                      - T49
                      - T50
                      - T51
                      - T52
                      - T53
                      - T54
                      - T55
                      - T56
                      - T57
                      - T74
                      - T45-REVERSE
                      - T46-REVERSE
                      - T47-REVERSE
                      - T48-REVERSE
                      - T49-REVERSE
                      - T50-REVERSE
                      - T51-REVERSE
                      - T52-REVERSE
                      - T53-REVERSE
                      - T54-REVERSE
                      - T55-REVERSE
                      - T56-REVERSE
                      - T57-REVERSE
                      - T74-REVERSE
                  - hop: 2
                    id: S36
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 199.15383120205203
                        - 378.8349711332139
                        - 20
                    duality: C34
                    connects:
                      - T58
                      - T59
                      - T60
                      - T61
                      - T62
                      - T63
                      - T64
                      - T65
                      - T66
                      - T67
                      - T68
                      - T69
                      - T70
                      - T71
                      - T72
                      - T73
                      - T58-REVERSE
                      - T59-REVERSE
                      - T60-REVERSE
                      - T61-REVERSE
                      - T62-REVERSE
                      - T63-REVERSE
                      - T64-REVERSE
                      - T65-REVERSE
                      - T66-REVERSE
                      - T67-REVERSE
                      - T68-REVERSE
                      - T69-REVERSE
                      - T70-REVERSE
                      - T71-REVERSE
                      - T72-REVERSE
                      - T73-REVERSE
                  - hop: 2
                    id: S82
                    featureType: node
                    geometry:
                      type: Point
                      coordinates:
                        - 149.721383490353
                        - 528.7526484738582
                        - 0
                    duality: C80
                    connects:
                      - T5
                      - T6
                      - T7
                      - T8
                      - T9
                      - T45
                      - T5-REVERSE
                      - T6-REVERSE
                      - T7-REVERSE
                      - T8-REVERSE
                      - T9-REVERSE
                      - T45-REVERSE
                links: []
        '400':
          $ref: '#/components/responses/badRequest'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
  /collections/{collectionId}/items/{featureId}/layers/{tId}/dual/{mId}:
    parameters:
      - $ref: '#/components/parameters/collectionId'
      - $ref: '#/components/parameters/featureId'
      - $ref: '#/components/parameters/tId'
      - $ref: '#/components/parameters/mId'
    get:
      tags:
        - DualSpaceLayer
      summary: Get a specific Edge
      description: |-
        Retrieves a single Edge from the Dual Space. 
        An Edge represents the topological adjacency/connectivity between two States (Nodes). 
        **Dependency Logic:** Includes a `duality` link to the corresponding CellBoundary in the Primal Space.
      operationId: getEdge
      responses:
        '200':
          description: Success. Returns the requested Edge.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/edge'
              example:
                featureType: Edge
                id: edge-101-100
                connects:
                  - node-101
                  - node-100
                weight: 1.5
                geometry:
                  type: LineString
                  coordinates:
                    - - 5
                      - 5
                    - - 15
                      - 5
        '400':
          $ref: '#/components/responses/badRequest'
        '404':
          $ref: '#/components/responses/notFound'
        '500':
          $ref: '#/components/responses/internalServerError'
    patch:
      tags:
        - DualSpaceLayer
      summary: update edge weight
      operationId: patchEdge
      requestBody:
        required: true
        content:
          application/merge-patch+json:
            schema:
              $ref: '#/components/schemas/edgeWeightUpdate'
      responses:
        '200':
          description: Successfully updated the edge weight.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/edge'
        '400':
          description: Bad Request (e.g., invalid weight value).
        '404':
          description: Edge ID not found.
        '500':
          $ref: '#/components/responses/internalServerError'
    delete:
      tags:
        - DualSpaceLayer
      summary: delete a specific edge
      description: |-
        Permanently removes the edge from the navigation network.
        **Dependency Logic:** The server must update the `connects` array of the two Nodes previously linked by this edge to remove the reference.
      operationId: deleteEdge
      responses:
        '204':
          description: Successfully deleted.
        '404':
          description: Edge ID not found.
        '500':
          $ref: '#/components/responses/internalServerError'
components:
  schemas:
    link:
      type: object
      required:
        - href
        - rel
      properties:
        href:
          type: string
          example: http://data.example.com/buildings/123
        rel:
          type: string
          example: alternate
        type:
          type: string
          example: application/geo+json
        hreflang:
          type: string
          example: en
        title:
          type: string
          example: Trierer Strasse 70, 53115 Bonn
        length:
          type: integer
    extent:
      description: |-
        The extent of the features in the collection. In the Core only spatial and temporal
        extents are specified. Extensions may add additional members to represent other
        extents, for example, thermal or pressure ranges.

        An array of extents is provided for each extent type (spatial, temporal). The first item
        in the array describes the overall extent of the data. All subsequent items describe more
        precise extents, e.g., to identify clusters of data. Clients only interested in the
        overall extent will only need to access the first extent in the array.
      type: object
      properties:
        spatial:
          description: The spatial extent of the features in the collection.
          type: object
          properties:
            bbox:
              description: |-
                One or more bounding boxes that describe the spatial extent of the dataset.
                In the Core only a single bounding box is supported.

                Extensions may support additional areas.
                The first bounding box describes the overall spatial
                extent of the data. All subsequent bounding boxes describe
                more precise bounding boxes, e.g., to identify clusters of data.
                Clients only interested in the overall spatial extent will
                only need to access the first bounding box in the array.
              type: array
              minItems: 1
              items:
                description: |-
                  Each bounding box is provided as four or six numbers, depending on
                  whether the coordinate reference system includes a vertical axis
                  (height or depth):

                  * Lower left corner, coordinate axis 1
                  * Lower left corner, coordinate axis 2
                  * Minimum value, coordinate axis 3 (optional)
                  * Upper right corner, coordinate axis 1
                  * Upper right corner, coordinate axis 2
                  * Maximum value, coordinate axis 3 (optional)

                  If the value consists of four numbers, the coordinate reference system is
                  WGS 84 longitude/latitude (http://www.opengis.net/def/crs/OGC/1.3/CRS84)
                  unless a different coordinate reference system is specified in `crs`.

                  If the value consists of six numbers, the coordinate reference system is WGS 84
                  longitude/latitude/ellipsoidal height (http://www.opengis.net/def/crs/OGC/0/CRS84h)
                  unless a different coordinate reference system is specified in `crs`.

                  For WGS 84 longitude/latitude the values are in most cases the sequence of
                  minimum longitude, minimum latitude, maximum longitude and maximum latitude.
                  However, in cases where the box spans the antimeridian the first value
                  (west-most box edge) is larger than the third value (east-most box edge).

                  If the vertical axis is included, the third and the sixth number are
                  the bottom and the top of the 3-dimensional bounding box.

                  If a feature has multiple spatial geometry properties, it is the decision of the
                  server whether only a single spatial geometry property is used to determine
                  the extent or all relevant geometries.
                type: array
                oneOf:
                  - minItems: 4
                    maxItems: 4
                  - minItems: 6
                    maxItems: 6
                items:
                  type: number
                example:
                  - -180
                  - -90
                  - 180
                  - 90
            crs:
              description: |-
                Coordinate reference system of the coordinates in the spatial extent
                (property `bbox`). The default reference system is WGS 84 longitude/latitude.
                In the Core the only other supported coordinate reference system is
                WGS 84 longitude/latitude/ellipsoidal height for coordinates with height.
                Extensions may support additional coordinate reference systems and add
                additional enum values.
              type: string
              enum:
                - http://www.opengis.net/def/crs/OGC/1.3/CRS84
                - http://www.opengis.net/def/crs/OGC/0/CRS84h
              default: http://www.opengis.net/def/crs/OGC/1.3/CRS84
        temporal:
          description: The temporal extent of the features in the collection.
          type: object
          properties:
            interval:
              description: |-
                One or more time intervals that describe the temporal extent of the dataset.
                In the Core only a single time interval is supported.

                Extensions may support multiple intervals.
                The first time interval describes the overall
                temporal extent of the data. All subsequent time intervals describe
                more precise time intervals, e.g., to identify clusters of data.
                Clients only interested in the overall temporal extent will only need
                to access the first time interval in the array (a pair of lower and upper
                bound instants).
              type: array
              minItems: 1
              items:
                description: |-
                  Begin and end times of the time interval. The timestamps are in the
                  temporal coordinate reference system specified in `trs`. By default
                  this is the Gregorian calendar.

                  The value `null` at start or end is supported and indicates a half-bounded interval.
                type: array
                minItems: 2
                maxItems: 2
                items:
                  type: string
                  format: date-time
                  nullable: true
                example:
                  - '2011-11-11T12:22:11Z'
                  - null
            trs:
              description: |-
                Coordinate reference system of the coordinates in the temporal extent
                (property `interval`). The default reference system is the Gregorian calendar.
                In the Core this is the only supported temporal coordinate reference system.
                Extensions may support additional temporal coordinate reference systems and add
                additional enum values.
              type: string
              enum:
                - http://www.opengis.net/def/uom/ISO-8601/0/Gregorian
              default: http://www.opengis.net/def/uom/ISO-8601/0/Gregorian
    collection:
      type: object
      required:
        - id
        - title
        - itemType
        - links
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        itemType:
          type: string
          default: indoorfeature
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
          example:
            - href: http://data.example.com/collections/tokyo_odaiba
              rel: self
        extent:
          $ref: '#/components/schemas/extent'
        crs:
          description: the list of coordinate reference systems supported by the service
          type: array
          items:
            type: string
          default:
            - https://www.opengis.net/def/crs/OGC/1.3/CRS84
          example:
            - https://www.opengis.net/def/crs/OGC/1.3/CRS84
            - https://www.opengis.net/def/crs/EPSG/0/4326
    collections:
      type: object
      required:
        - collections
        - links
      properties:
        collections:
          type: array
          items:
            $ref: '#/components/schemas/collection'
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
    apiErrorDetail:
      type: object
      additionalProperties: false
      required:
        - target
        - message
      properties:
        target:
          type: string
          description: The parameter or field that caused the error.
          example: ex) geometry
        message:
          type: string
          description: Explanation for the target field.
          example: ex) Failed to parse WKT geometry.
        value:
          description: The provided value that caused the error (optional).
          oneOf:
            - type: string
            - type: number
            - type: integer
            - type: boolean
            - type: object
            - type: array
    apiError:
      type: object
      additionalProperties: false
      required:
        - type
        - code
        - description
      properties:
        type:
          type: string
          enum:
            - Error
          description: Identifies this object as an error response.
        code:
          type: string
          description: Machine-readable error code.
        description:
          type: string
          description: Human-readable error message.
        status:
          type: integer
          description: HTTP status code.
        details:
          type: array
          description: Optional list of detailed error items.
          items:
            $ref: '#/components/schemas/apiErrorDetail'
        instance:
          type: string
          format: uri
          description: Optional URI to identify this specific occurrence for debugging/logging.
    collections_post:
      type: object
      required:
        - id
        - title
        - itemType
      properties:
        id:
          type: string
        title:
          type: string
          description: Human readable title of the collection
        description:
          type: string
          description: Any description
        itemType:
          type: string
          description: Indicator about the type of the items in the indoor features collection (the default value is 'indoorfeature').
          default: indoorfeature
    apiResponse:
      type: object
      additionalProperties: false
      required:
        - type
        - data
      properties:
        type:
          type: string
          enum:
            - Response
          description: Identifies this object as a response.
        data:
          type: object
          description: The response data.
          additionalProperties: true
    pointGeoJSON:
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          type: string
          enum:
            - Point
        coordinates:
          type: array
          minItems: 2
          items:
            type: number
    multipointGeoJSON:
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          type: string
          enum:
            - MultiPoint
        coordinates:
          type: array
          items:
            type: array
            minItems: 2
            items:
              type: number
    linestringGeoJSON:
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          type: string
          enum:
            - LineString
        coordinates:
          type: array
          minItems: 2
          items:
            type: array
            minItems: 2
            items:
              type: number
    multilinestringGeoJSON:
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          type: string
          enum:
            - MultiLineString
        coordinates:
          type: array
          items:
            type: array
            minItems: 2
            items:
              type: array
              minItems: 2
              items:
                type: number
    polygonGeoJSON:
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          type: string
          enum:
            - Polygon
        coordinates:
          type: array
          items:
            type: array
            minItems: 4
            items:
              type: array
              minItems: 2
              items:
                type: number
    multipolygonGeoJSON:
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          type: string
          enum:
            - MultiPolygon
        coordinates:
          type: array
          items:
            type: array
            items:
              type: array
              minItems: 4
              items:
                type: array
                minItems: 2
                items:
                  type: number
    geometryGeoJSON:
      oneOf:
        - $ref: '#/components/schemas/pointGeoJSON'
        - $ref: '#/components/schemas/multipointGeoJSON'
        - $ref: '#/components/schemas/linestringGeoJSON'
        - $ref: '#/components/schemas/multilinestringGeoJSON'
        - $ref: '#/components/schemas/polygonGeoJSON'
        - $ref: '#/components/schemas/multipolygonGeoJSON'
        - $ref: '#/components/schemas/geometrycollectionGeoJSON'
    geometrycollectionGeoJSON:
      type: object
      required:
        - type
        - geometries
      properties:
        type:
          type: string
          enum:
            - GeometryCollection
        geometries:
          type: array
          items:
            $ref: '#/components/schemas/geometryGeoJSON'
    metaGeoJSON:
      type: object
      title: featureGeoJSON
      required:
        - type
        - geometry
        - properties
      properties:
        type:
          type: string
          enum:
            - Feature
        featureType:
          type: string
          enum:
            - IndoorFeatures
        id:
          type: string
        geometry:
          $ref: '#/components/schemas/geometryGeoJSON'
        properties:
          type: object
          properties:
            metadata:
              type: object
              properties:
                description:
                  type: string
                creationDate:
                  type: string
                  format: date-time
                version:
                  type: string
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
    featuresGeoJSON:
      type: object
      title: featureCollectionGeoJSON
      required:
        - type
        - features
      properties:
        type:
          type: string
          enum:
            - FeatureCollection
        features:
          type: array
          items:
            $ref: '#/components/schemas/metaGeoJSON'
        numberMatched:
          type: integer
        numberReturned:
          type: integer
        timeStamp:
          type: string
          format: date-time
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
    refsys-simpleref:
      type: string
      format: uri-reference
    refsys-byref:
      type: object
      required:
        - type
        - href
      properties:
        type:
          type: string
          const: Reference
        href:
          type: string
          format: uri-reference
        epoch:
          type: number
    refsys-custom:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          not:
            const: Reference
    single-refsys:
      oneOf:
        - $ref: '#/components/schemas/refsys-simpleref'
        - $ref: '#/components/schemas/refsys-byref'
        - $ref: '#/components/schemas/refsys-custom'
    coordrefsys:
      $schema: https://json-schema.org/draft/2020-12/schema
      $id: https://beta.schemas.opengis.net/json-fg/coordrefsys.json
      title: the value of the 'coordRefSys' member
      description: This JSON Schema is part of JSON-FG version 0.3.0.
      oneOf:
        - $ref: '#/components/schemas/single-refsys'
        - type: array
          items:
            $ref: '#/components/schemas/single-refsys'
          minItems: 2
      $defs:
        single-refsys:
          oneOf:
            - $ref: '#/components/schemas/refsys-simpleref'
            - $ref: '#/components/schemas/refsys-byref'
            - $ref: '#/components/schemas/refsys-custom'
        refsys-simpleref:
          type: string
          format: uri-reference
        refsys-byref:
          type: object
          required:
            - type
            - href
          properties:
            type:
              type: string
              const: Reference
            href:
              type: string
              format: uri-reference
            epoch:
              type: number
        refsys-custom:
          type: object
          required:
            - type
          properties:
            type:
              type: string
              not:
                const: Reference
    measures:
      $schema: https://json-schema.org/draft/2020-12/schema
      $id: https://beta.schemas.opengis.net/json-fg/measures.json
      title: the value of the 'measures' member
      description: This JSON Schema is part of JSON-FG version 0.3.0.
      type: object
      properties:
        enabled:
          type: boolean
        unit:
          type: string
        description:
          type: string
      required:
        - enabled
    position:
      type: array
      minItems: 2
      maxItems: 4
      items:
        type: number
    bbox2d:
      type: array
      minItems: 4
      maxItems: 4
      items:
        type: number
    bbox3d:
      type: array
      minItems: 6
      maxItems: 6
      items:
        type: number
    bbox:
      oneOf:
        - $ref: '#/components/schemas/bbox2d'
        - $ref: '#/components/schemas/bbox3d'
    Polygon:
      title: GeoJSON Polygon with additional 'coordRefSys' and 'measures' members
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          const: Polygon
        coordRefSys:
          $ref: '#/components/schemas/coordrefsys'
        measures:
          $ref: '#/components/schemas/measures'
        coordinates:
          type: array
          items:
            type: array
            minItems: 4
            items:
              $ref: '#/components/schemas/position'
        bbox:
          $ref: '#/components/schemas/bbox'
    position3d:
      type: array
      minItems: 3
      maxItems: 4
      items:
        type: number
    Polyhedron:
      title: JSON-FG Polyhedron
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          const: Polyhedron
        coordRefSys:
          $ref: '#/components/schemas/coordrefsys'
        measures:
          $ref: '#/components/schemas/measures'
        coordinates:
          type: array
          minItems: 1
          items:
            type: array
            minItems: 1
            items:
              type: array
              minItems: 1
              items:
                type: array
                minItems: 4
                items:
                  $ref: '#/components/schemas/position3d'
        bbox:
          $ref: '#/components/schemas/bbox3d'
    externalReferenceType:
      ExternalReferenceType:
        type: object
        required:
          - externalObject
          - informationSystem
        properties:
          externalObject:
            type: object
            required:
              - name
              - uri
            properties:
              name:
                type: string
              uri:
                type: string
                format: uri
          informationSystem:
            type: string
            format: uri
    cellSpace:
      type: object
      title: CellSpace
      required:
        - id
        - featureType
        - poi
      properties:
        id:
          type: string
        featureType:
          type: string
          enum:
            - CellSpace
        cellSpaceName:
          type: string
        level:
          type: string
        poi:
          type: boolean
        duality:
          type: string
          format: uri-reference
        cellSpaceGeom:
          type: object
          properties:
            geometry2D:
              $ref: '#/components/schemas/Polygon'
            geometry3D:
              $ref: '#/components/schemas/Polyhedron'
        boundedBy:
          type: array
          uniqueItems: true
          items:
            type: string
            format: uri-reference
        externalReference:
          $ref: '#/components/schemas/externalReferenceType'
    LineString:
      title: GeoJSON LineString with additional 'coordRefSys' and 'measures' members
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          const: LineString
        coordRefSys:
          $ref: '#/components/schemas/coordrefsys'
        measures:
          $ref: '#/components/schemas/measures'
        coordinates:
          type: array
          minItems: 2
          items:
            $ref: '#/components/schemas/position'
        bbox:
          $ref: '#/components/schemas/bbox'
    cellBoundary:
      type: object
      title: CellBoundary
      required:
        - id
        - featureType
        - isVirtual
      properties:
        id:
          type: string
        featureType:
          type: string
          enum:
            - CellBoundary
        isVirtual:
          type: boolean
        duality:
          type: string
          format: uri-reference
        cellBoundaryGeom:
          type: object
          properties:
            geometry2D:
              $ref: '#/components/schemas/LineString'
            geometry3D:
              $ref: '#/components/schemas/Polygon'
        externalReference:
          $ref: '#/components/schemas/externalReferenceType'
    primalSpaceLayer:
      type: object
      title: PrimalSpaceLayer
      required:
        - id
        - featureType
        - cellSpaceMember
      properties:
        id:
          type: string
        featureType:
          type: string
          enum:
            - PrimalSpaceLayer
        creationDatetime:
          type: string
          format: date-time
        terminationDatetime:
          type: string
          format: date-time
        cellSpaceMember:
          type: array
          minItems: 1
          uniqueItems: true
          items:
            $ref: '#/components/schemas/cellSpace'
        cellBoundaryMember:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/cellBoundary'
    Point:
      title: GeoJSON Point with additional 'coordRefSys' and 'measures' members
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          const: Point
        coordRefSys:
          $ref: '#/components/schemas/coordrefsys'
        measures:
          $ref: '#/components/schemas/measures'
        coordinates:
          $ref: '#/components/schemas/position'
        bbox:
          $ref: '#/components/schemas/bbox'
    node:
      type: object
      title: Node
      required:
        - id
        - featureType
        - duality
      properties:
        id:
          type: string
        featureType:
          type: string
          enum:
            - Node
        duality:
          type: string
          format: uri-reference
        geometry:
          $ref: '#/components/schemas/Point'
        connects:
          type: array
          uniqueItems: true
          items:
            type: string
            format: uri-reference
      example:
        featureType: Node
        id: node-corridor
        duality: cell-office-102
        geometry:
          type: Point
          coordinates:
            - 15
            - 5
    edge:
      type: object
      title: Edge
      required:
        - id
        - featureType
        - weight
        - connects
      properties:
        id:
          type: string
        featureType:
          type: string
          enum:
            - Edge
        duality:
          type: string
          format: uri-reference
          description: Reference to the corresponding primal Space cell (e.g., a door or opening).
        weight:
          type: number
        geometry:
          $ref: '#/components/schemas/LineString'
        connects:
          type: array
          minItems: 2
          maxItems: 2
          uniqueItems: true
          items:
            type: string
            format: uri-reference
    dualSpaceLayer:
      type: object
      title: DualSpaceLayer
      required:
        - id
        - featureType
        - isLogical
        - isDirected
        - nodeMember
      properties:
        id:
          type: string
        featureType:
          type: string
          enum:
            - DualSpaceLayer
        isLogical:
          type: boolean
        isDirected:
          type: boolean
        nodeMember:
          type: array
          minItems: 1
          uniqueItems: true
          items:
            $ref: '#/components/schemas/node'
        edgeMember:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/edge'
    thematicLayer:
      type: object
      title: ThematicLayer
      required:
        - id
        - featureType
        - semanticExtension
        - theme
      properties:
        id:
          type: string
        featureType:
          type: string
          enum:
            - ThematicLayer
        semanticExtension:
          type: boolean
        theme:
          type: string
          enum:
            - Virtual
            - Physical
            - Tags
            - Unknown
        primalSpace:
          $ref: '#/components/schemas/primalSpaceLayer'
        dualSpace:
          $ref: '#/components/schemas/dualSpaceLayer'
    interLayerConnection:
      type: object
      title: InterLayerConnection
      required:
        - featureType
        - connectedLayers
        - typeOfTopoExpression
      properties:
        id:
          type: string
        featureType:
          type: string
          enum:
            - InterLayerConnection
        connectedLayers:
          type: array
          items:
            type: string
            format: uri-reference
          minItems: 2
          maxItems: 2
          uniqueItems: true
          description: Links exactly two thematic layers.
        connectedNodes:
          type: array
          items:
            type: string
            format: uri-reference
          minItems: 2
          maxItems: 2
          uniqueItems: true
          description: Links specific nodes across the layers.
        connectedCells:
          type: array
          items:
            type: string
            format: uri-reference
          minItems: 2
          maxItems: 2
          uniqueItems: true
          description: Links specific primal space cells across the layers.
        typeOfTopoExpression:
          type: string
          enum:
            - CONTAINS
            - OVERLAPS
            - EQUALS
            - WITHIN
            - CROSSES
            - OTHERS
        comment:
          type: string
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
    indoorFeature:
      type: object
      title: IndoorFeatures
      required:
        - featureType
        - layers
      properties:
        id:
          type: string
        featureType:
          type: string
          enum:
            - IndoorFeatures
        layers:
          type: array
          minItems: 1
          uniqueItems: true
          items:
            $ref: '#/components/schemas/thematicLayer'
        layerConnections:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/interLayerConnection'
    indoorJSON:
      type: object
      description: Root schema for IndoorGML 2.0 IndoorFeatures
      allOf:
        - $ref: '#/components/schemas/indoorFeature'
    featureGeoJSON:
      type: object
      title: featureGeoJSON
      required:
        - type
        - geometry
        - properties
      properties:
        type:
          type: string
          enum:
            - Feature
        featureType:
          type: string
          enum:
            - IndoorFeatures
        id:
          type: string
        geometry:
          $ref: '#/components/schemas/geometryGeoJSON'
        properties:
          type: object
          properties:
            metadata:
              type: object
              properties:
                description:
                  type: string
                creationDate:
                  type: string
                  format: date-time
                version:
                  type: string
        IndoorFeatures:
          $ref: '#/components/schemas/indoorFeature'
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
    thematicLayerListElement:
      type: object
      title: ThematicLayerListElement
      required:
        - id
        - semanticExtension
        - theme
      properties:
        id:
          type: string
        semanticExtension:
          type: boolean
        theme:
          type: string
          enum:
            - Virtual
            - Physical
            - Tags
            - Unknown
        bbox:
          type: array
          minItems: 4
          maxItems: 4
          items:
            type: number
          example:
            - 139.774
            - 35.618
            - 139.78
            - 35.624
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
    thematicLayerList:
      type: object
      title: ThematicLayerList
      properties:
        levels:
          type: array
          description: List of all floors available in this IndoorFeature.
          items:
            type: string
          example:
            - L
            - '2'
            - '3'
            - F
            - '5'
        layers:
          type: array
          items:
            $ref: '#/components/schemas/thematicLayerListElement'
    interLayerConnections:
      type: object
      title: InterLayerConnections
      required:
        - layerConnections
      properties:
        layerConnections:
          type: array
          items:
            $ref: '#/components/schemas/interLayerConnection'
    thematicLayerSummary:
      type: object
      title: ThematicLayerSummary
      required:
        - id
        - featureType
        - semanticExtension
        - theme
      properties:
        id:
          type: string
          example: layer-indoor-nav-f1
        featureType:
          type: string
          enum:
            - ThematicLayer
          example: ThematicLayer
        theme:
          type: string
          enum:
            - Virtual
            - Physical
            - Tags
            - Unknown
          example: Virtual
        semanticExtension:
          type: boolean
          example: true
        summary:
          type: object
          description: Statistical summary of the Primal and Dual space contents.
          properties:
            primalSpace:
              type: object
              properties:
                cellSpaceCount:
                  type: integer
                  description: Number of rooms/cells.
                  example: 2
                cellBoundaryCount:
                  type: integer
                  description: Number of walls/boundaries.
                  example: 1
                level:
                  type: string
                  description: The floor level(s) found in this layer.
                  example: 1F
            dualSpace:
              type: object
              properties:
                nodeCount:
                  type: integer
                  description: Number of navigation nodes.
                  example: 2
                edgeCount:
                  type: integer
                  description: Number of navigation edges.
                  example: 1
                isDirected:
                  type: boolean
                  description: Copy of the isDirected property from DualSpaceLayer.
                  example: true
                isLogical:
                  type: boolean
                  description: Copy of the isLogical property from DualSpaceLayer.
                  example: true
        bbox:
          type: array
          minItems: 4
          maxItems: 4
          items:
            type: number
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
      example:
        id: layer-indoor-nav-f1
        featureType: ThematicLayer
        theme: virtual
        semanticExtension: true
        summary:
          primalSpace:
            cellSpaceCount: 2
            cellBoundaryCount: 1
            level:
              - 1F
          dualSpace:
            nodeCount: 2
            edgeCount: 1
            isDirected: true
            isLogical: true
        bbox:
          - 0
          - 0
          - 20
          - 10
        links:
          - href: http://localhost:5000/collections/aist_waterfront_lab/items/AIST_Waterfront_Center/layers/layer-indoor-nav-f1
            rel: self
            type: application/json
            title: Thematic Layer
    geoQueryResults:
      title: geoQueryResult
      type: object
      required:
        - id
        - featureType
        - primalSpace
        - dualSpace
      properties:
        id:
          type: string
          description: The id_str of the thematic layer.
        featureType:
          type: string
          enum:
            - ThematicLayer
        theme:
          type: string
        semanticExtension:
          type: string
          nullable: true
        primalSpace:
          $ref: '#/components/schemas/primalSpaceLayer'
        dualSpace:
          $ref: '#/components/schemas/dualSpaceLayer'
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
    routeResults:
      title: RouteResult
      type: object
      required:
        - type
        - start_node
        - destination_node
        - cost
        - path_segments
      properties:
        type:
          type: string
          enum:
            - RouteResult
        start_node:
          type: string
          description: Start node identifier (sn).
        destination_node:
          type: string
          description: Destination node identifier (dn).
        cost:
          type: number
          format: double
          description: The total aggregated weight/length of the path.
        path_segments:
          type: array
          items:
            type: object
            required:
              - seq
              - type
              - id_str
              - cost
              - geometry
            properties:
              seq:
                type: integer
              type:
                type: string
                enum:
                  - edge
                  - destination_node
              id_str:
                type: string
              cost:
                type: number
              geometry:
                $ref: '#/components/schemas/LineString'
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
    cellSpaceUpdate:
      CellSpaceUpdate:
        type: object
        title: CellSpaceUpdate
        description: Available fields for partial update. All fields are optional.
        properties:
          cellSpaceName:
            type: string
            example: Conference Room A
          level:
            type: integer
            example: 2
          poi:
            type: string
            example: Restroom
      example:
        cellSpaceName: Executive Office
        poi: true
        boundedBy:
          - '#boundary-wall-01'
          - '#boundary-wall-02'
    connectedResults:
      title: ConnectedNodesResult
      type: object
      additionalProperties: false
      required:
        - type
        - start_node
        - connected_nodes
      properties:
        type:
          type: string
          enum:
            - ConnectedNodesResult
          description: Identifies this response as a connectivity query result.
        start_node:
          type: string
          description: The identifier of the source node from which the search started.
        connected_nodes:
          type: array
          description: List of nodes reachable within the specified hop distance.
          items:
            type: object
            required:
              - hop
              - id
              - featureType
              - geometry
              - duality
              - connects
            properties:
              hop:
                type: integer
                description: The distance in steps from the start node.
              id:
                type: string
                description: Identifier of the connected node.
              featureType:
                type: string
                enum:
                  - node
              geometry:
                $ref: '#/components/schemas/Point'
              duality:
                type: string
                nullable: true
                description: ID of the corresponding CellSpace in primal space.
              connects:
                type: array
                items:
                  type: string
                description: List of Edge/Transition IDs connected to this node.
        links:
          type: array
          items:
            $ref: '#/components/schemas/link'
    edgeWeightUpdate:
      type: object
      required:
        - weight
      properties:
        weight:
          type: number
          format: double
          description: The new weight value for the edge. Weights cannot be negative
          minimum: 0
      example:
        weight: 1.5
  responses:
    collections:
      description: A JSON object containing the list of available collections and related links.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/collections'
          example:
            collections:
              - id: indoor-pnu
                title: PNU STEMLab Indoor Features
                description: Physical rooms and logical nodes from IndoorJSON.
                keywords:
                  - IndoorGML
                  - PNU
                links:
                  - type: application/json
                    rel: root
                    title: The landing page of this server as JSON
                    href: https://data.example.org?f=json
                  - type: text/html
                    rel: root
                    title: The landing page of this server as HTML
                    href: https://data.example.org?f=html
                  - type: application/json
                    rel: self
                    title: This document as JSON
                    href: https://data.example.org/collections/indoor-pnu?f=json
                  - type: application/ld+json
                    rel: alternate
                    title: This document as RDF (JSON-LD)
                    href: https://data.example.org/collections/indoor-pnu?f=jsonld
                  - type: text/html
                    rel: alternate
                    title: This document as HTML
                    href: https://data.example.org/collections/indoor-pnu?f=html
                  - type: application/geo+json
                    rel: items
                    title: Items as GeoJSON
                    href: https://data.example.org/collections/indoor-pnu/items?f=json
                  - type: text/html
                    rel: items
                    title: Items as HTML
                    href: https://data.example.org/collections/indoor-pnu/items?f=html
                  - type: application/schema+json
                    rel: http://www.opengis.net/def/rel/ogc/1.0/queryables
                    title: Queryables for this collection as JSON
                    href: https://data.example.org/collections/indoor-pnu/queryables?f=json
                extent:
                  spatial:
                    bbox:
                      - - 0
                        - 0
                        - 4
                        - 2
                    crs: http://www.opengis.net/def/crs/OGC/1.3/CRS84
                itemType: feature
              - id: aist_waterfront_lab
                title: AIST Waterfront Lab IndoorGML
                description: IndoorGML data for AIST Waterfront Lab IndoorGML
                itemType: indoorfeature
                keywords: []
                links:
                  - type: application/schema+json
                    rel: http://www.opengis.net/def/rel/ogc/1.0/queryables
                    title: Queryables for this collection as JSON
                    href: https://data.example.org/collections/aist_waterfront_lab/queryables?f=json
                  - type: application/json
                    rel: root
                    title: The landing page of this server as JSON
                    href: https://data.example.org?f=json
                  - type: application/json
                    rel: self
                    title: This document as JSON
                    href: https://data.example.org/collections/aist_waterfront_lab?f=json
                  - type: application/geo+json
                    rel: items
                    title: Items as GeoJSON
                    href: https://data.example.org/collections/aist_waterfront_lab/items?f=json
                  - type: text/html
                    rel: items
                    title: Items as HTML
                    href: https://data.example.org/collections/aist_waterfront_lab/items?f=html
            links:
              - type: application/json
                rel: self
                title: This document as JSON
                href: https://data.example.org/collections?f=json
              - type: application/ld+json
                rel: alternate
                title: This document as RDF (JSON-LD)
                href: https://data.example.org/collections?f=jsonld
              - type: text/html
                rel: alternate
                title: This document as HTML
                href: https://data.example.org/collections?f=html
    unauthorized:
      description: Authentication credentials were missing or invalid.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/apiError'
          example:
            type: Error
            code: Unauthorized
            description: Authentication is required. Please provide a valid API key or Bearer token in the Authorization header.
            status: 401
            instance: urn:uuid:c9b8a7f6-e5d4-4c3b-b2a1-0f9e8d7c6b5a
    internalServerError:
      description: Unexpected server error.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/apiError'
          example:
            code: '500'
            description: Server Internal Error
    conflictError:
      description: The specified Id already exists.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/apiError'
          example:
            type: Error
            code: IdAlreadyExists
            description: The specified ID 'building-88' already exists in the collection.
            status: 409
            instance: urn:uuid:550e8400-e29b-41d4-a716-446655440000
    collection:
      description: The metadata being returned.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/collection'
          example:
            id: aist_waterfront_lab
            title: AIST Waterfront Lab IndoorGML
            description: IndoorGML data for AIST Waterfront Lab project.
            itemType: indoorfeature
            extent:
              spatial:
                bbox:
                  - - 139.774
                    - 35.618
                    - 139.78
                    - 35.624
                crs: http://www.opengis.net/def/crs/OGC/1.3/CRS84
            links:
              - href: https://data.example.org/collections/aist_waterfront_lab?f=json
                rel: self
                type: application/json
                title: This document as JSON
              - href: https://data.example.org/collections/aist_waterfront_lab/items?f=json
                rel: items
                type: application/geo+json
                title: Indoor features in this collection
              - href: https://data.example.org?f=json
                rel: root
                type: application/json
                title: The landing page of this server
    notFound:
      description: The requested resource was not found.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/apiError'
          example:
            type: Error
            code: NotFound
            description: The requested IndoorFeature with the provided ID could not be found.
            status: 404
            instance: urn:uuid:a1b2c3d4-e5f6-4a5b-8c9d-0e1f2a3b4c5d
    noContent:
      description: The request was successful but there is no content to return (Deleted).
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/apiResponse'
          example:
            type: Success
            code: ResourceDeleted
            description: The IndoorFeature was successfully removed from the database.
            status: 200
    forbidden:
      description: The request was valid, but the server is refusing action.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/apiError'
          example:
            type: Error
            code: PermissionDenied
            description: The authenticated user does not have permission to modify this IndoorFeature collection.
            status: 403
            instance: urn:uuid:883c4421-3e11-4b2a-9e1d-223344556677
    badRequest:
      description: Invalid request parameters or malformed input.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/apiError'
          example:
            type: Error
            code: InvalidParameter
            description: The 'bbox' parameter must contain 4 or 6 coordinates.
            status: 400
            instance: urn:uuid:2d1b9b9a-7db6-4d5b-9f1d-0f1a0b5c6a33
    features:
      description: A list of indoor features (fIDs) within the collection.
      content:
        application/geo+json:
          schema:
            $ref: '#/components/schemas/featuresGeoJSON'
    payloadTooLarge:
      description: The request is too large for the server to process.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/apiError'
          example:
            type: Error
            code: PayloadTooLarge
            description: The uploaded IndoorGML file exceeds the maximum allowed size of 10MB.
            status: 413
            instance: urn:uuid:f47ac10b-58cc-4372-a567-0e02b2c3d479
    unprocessableEntity:
      description: Unprocessable Entity (Missing Required field for schema or logical mismatch).
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/apiError'
          example:
            type: Error
            code: UnprocessableEntity
            description: The request was well-formed but contains semantic errors or missing required fields.
            status: 422
            instance: urn:uuid:7c9e0b21-4f1a-4d3c-9b8a-112233445566
            details:
              - field: layers
                issue: 'Missing required ThematicLayer: ''Basement'''
  parameters:
    collectionId:
      name: collectionId
      in: path
      description: Local identifier of a collection (e.g., 'AIST_Waterfront').
      required: true
      schema:
        type: string
    limit:
      name: limit
      in: query
      description: |-
        The optional limit parameter limits the number of items that are presented in the response document.
        Only items are counted that are on the first level of the collection in the response document. 
        Nested objects contained within the explicitly requested items shall not be counted.

        Minimum = 1. Maximum = 10000. Default = 10.
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 10000
        default: 10
      style: form
      explode: false
    bbox:
      name: bbox
      in: query
      description: |-
        Spatial filter [minX, minY, maxX, maxY].

        Only features that have a geometry that intersects the bounding box are selected. 

        The bounding box is provided as four numbers, recommended to use with `level`

        Can be used alone not regarding the z axis for 3D geometries.
      required: false
      schema:
        type: array
        minItems: 4
        maxItems: 4
        items:
          type: number
      style: form
      explode: false
      example:
        - 129
        - 35.1
        - 129.1
        - 35.2
    geoJSONBbox:
      name: geoJSONBbox
      in: query
      required: false
      description: |-
        Only features that have a geometry that intersects the bounding box are selected. The bounding box is provided as four or six numbers, depending on whether the coordinate reference system includes a vertical axis (height or depth):
        Lower left corner, coordinate axis 1
        Lower left corner, coordinate axis 2
        Minimum value, coordinate axis 3 (optional)
        Upper right corner, coordinate axis 1
        Upper right corner, coordinate axis 2
        Maximum value, coordinate axis 3 (optional)
        If the value consists of four numbers, the coordinate reference system is WGS 84 longitude/latitude (http://www.opengis.net/def/crs/OGC/1.3/CRS84) unless a different coordinate reference system is specified in the parameter bbox-crs.

        If the value consists of six numbers, the coordinate reference system is WGS 84 longitude/latitude/ellipsoidal height (http://www.opengis.net/def/crs/OGC/0/CRS84h) unless a different coordinate reference system is specified in the parameter bbox-crs.

        The query parameter bbox-crs is specified in OGC API - Features - Part 2: Coordinate Reference Systems by Reference.

        For WGS 84 longitude/latitude the values are in most cases the sequence of minimum longitude, minimum latitude, maximum longitude and maximum latitude. However, in cases where the box spans the antimeridian the first value (west-most box edge) is larger than the third value (east-most box edge).

        If the vertical axis is included, the third and the sixth number are the bottom and the top of the 3-dimensional bounding box.

        If a feature has multiple spatial geometry properties, it is the decision of the server whether only a single spatial geometry property is used to determine the extent or all relevant geometries.
      schema:
        type: array
        minItems: 4
        maxItems: 6
        items:
          type: number
      example:
        - 13.4
        - 52.5
        - 13.5
        - 52.6
    featureId:
      name: featureId
      in: path
      description: Local identifier of a specific indoor feature (e.g., 'IF_AIST_001').
      required: true
      schema:
        type: string
    level:
      name: level
      in: query
      description: |
        Filters the indoorFeatures, thematicLayer, and primalSpace content by a specific floor level.

        **Filtering Logic:**
        * **Primal Space:** The filter is explicitly applied to `CellSpace` geometries on the specified level (e.g., '1F', 'B1').
        * **Inferred Members:** Other members of the Primal and Dual spaces (e.g., boundaries, nodes, edges) are automatically included based on their relationships (`boundedBy`, `duality`) with the selected CellSpaces.

        **Note:** If both this parameter or `bbox` is omitted, the response will return **metadata only** to reduce payload size.
      required: false
      schema:
        type: string
        example: 1F
    theme:
      name: theme
      in: query
      description: Filter layers by category.
      required: false
      schema:
        type: string
        enum:
          - Virtual
          - Physical
          - Tags
          - Unknown
    connectedLayerId:
      name: connectedLayerId
      in: query
      description: Filter to find all connections involving a specific thematic layer ID.
      required: false
      schema:
        type: string
    typeOfTopoExpression:
      name: typeOfTopoExpression
      in: query
      description: Filter by the topological relationship type.
      required: false
      schema:
        type: string
        enum:
          - CONTAINS
          - OVERLAPS
          - EQUALS
          - WITHIN
          - CROSSES
          - OTHERS
    cnId:
      name: cnId
      in: path
      description: Local identifier of a specific inter-layer connection (e.g., 'ILC-001').
      required: true
      schema:
        type: string
    tId:
      name: tId
      in: path
      description: Local identifier of a thematic layer (e.g., 'TL-Physical-01').
      required: true
      schema:
        type: string
    poi:
      name: poi
      in: query
      description: Filter CellSpaces by Point of Interest status.
      required: false
      schema:
        type: boolean
    isVirtual:
      name: isVirtual
      in: query
      description: Filter CellBoundaries by virtual status (e.g., invisible transitions).
      required: false
      schema:
        type: boolean
    cellSpaceName:
      name: cellSpaceName
      in: query
      required: false
      description: Filter results to include only those matching the specified CellSpace name. Exact Match
      schema:
        type: string
    op:
      name: op
      in: query
      required: true
      description: |-
        Spatial predicate operation applied between the input geometry
        and CellSpace geometries.

        Supported operations:
        - `within`: returns CellSpaces that contain the input geometry
        - `intersects`: returns CellSpaces whose geometries intersect the input geometry
        - `contains`: returns CellSpaces that are fully contained by the input geometry
      schema:
        type: string
        enum:
          - within
          - intersects
          - contains
    geometry:
      name: geometry
      in: query
      required: true
      description: |-
        Input geometry expressed as a 2D Well-Known Text (WKT) string.
        The geometry is evaluated in the local 2D coordinate reference
        of the IndoorFeature and the specified level.

        Only 2D geometries are supported. Z coordinates, if provided,
        are not allowed and will result in an error.

        Examples:
        - POINT(123.4 56.7)
        - POLYGON((120 40, 140 40, 140 60, 120 60, 120 40))
      schema:
        type: string
        example: POINT(123.4 56.7)
    sn:
      name: sn
      in: query
      description: Identifier of the start node in the dual graph
      required: true
      schema:
        type: string
    dn:
      name: dn
      in: query
      description: Identifier of the destination node in the dual graph
      required: true
      schema:
        type: string
    mId:
      name: mId
      in: path
      description: Local identifier of a specific memberId for Primal and Dual spaces (e.g., 'C83').
      required: true
      schema:
        type: string
    hop:
      name: hop
      in: query
      description: |-
        The maximum number of edges to traverse from the source node. 
        A value of 1 returns immediate neighbors.
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 4
        default: 1
      style: form
      explode: false
  examples:
    indoorFeature:
      featureType: IndoorFeatures
      id: AIST_Waterfront_Center
      geometry:
        type: Point
        coordinates:
          - 125.6
          - 10.1
      properties: {}
      layers:
        - id: TL-1
          featureType: ThematicLayer
          semanticExtension: false
          theme: Physical
          primalSpace:
            id: PS-1
            featureType: PrimalSpaceLayer
            creationDatetime: '2025-10-30T13:00:00'
            cellSpaceMember:
              - id: C1
                featureType: CellSpace
                duality: TL-1:DS-1:N1
                poi: false
                level: '1'
                cellSpaceGeom:
                  geometry2D:
                    type: Polygon
                    coordinates:
                      - - - 0
                          - 0
                        - - 2
                          - 0
                        - - 2
                          - 2
                        - - 0
                          - 2
                        - - 0
                          - 0
                boundedBy:
                  - TL-1:PS-1:B1
              - id: C2
                featureType: CellSpace
                duality: TL-1:DS-1:N2
                poi: false
                level: '1'
                cellSpaceGeom:
                  geometry2D:
                    type: Polygon
                    coordinates:
                      - - - 2
                          - 0
                        - - 4
                          - 0
                        - - 4
                          - 2
                        - - 2
                          - 2
                        - - 2
                          - 0
                boundedBy: []
            cellBoundaryMember:
              - id: B1
                featureType: CellBoundary
                isVirtual: false
                duality: TL-1:DS-1:E1
                cellBoundaryGeom:
                  geometry2D:
                    type: LineString
                    coordinates:
                      - - 2
                        - 0
                      - - 2
                        - 2
          dualSpace:
            id: DS-1
            featureType: DualSpaceLayer
            creationDatetime: '2025-10-30T13:00:00'
            isLogical: false
            isDirected: false
            nodeMember:
              - id: N1
                featureType: Node
                duality: TL-1:PS-1:C1
                geometry:
                  type: Point
                  coordinates:
                    - 1
                    - 1
                connects:
                  - TL-1:DS-1:E1
              - id: N2
                featureType: Node
                duality: C2
                geometry:
                  type: Point
                  coordinates:
                    - 3
                    - 1
                connects:
                  - E1
            edgeMember:
              - id: E1
                featureType: Edge
                duality: B1
                weight: 1
                geometry:
                  type: LineString
                  coordinates:
                    - - 1
                      - 1
                    - - 3
                      - 1
                connects:
                  - TL-1:DS-1:N1
                  - TL-1:DS-1:N2
