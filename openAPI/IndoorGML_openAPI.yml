openapi: '3.0.2'
info:
  title: IndoorGML/IndoorJSON API
  version: '1.0'
  description: |-
    An OGC-compliant API for managing IndoorGML 2.0 models using IndoorJSON.
    Optimized for documentation clarity and OGC Features compliance.
servers:
  - url: https://api.server.test/v1

paths:
  /collections:
    post:
      summary: Register metadata about a collection for indoor features
      description: |
        Creates a new collection to manage indoor features.
        
        **Configuration Note:**
        This endpoint requires the `itemType` field to specify the content type. For indoor feature collections, you must set `itemType` to `indoorfeature`.
      tags: 
      - IndoorFeatureCollection
      operationId: createCollection
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './schemas/collections_post.yml'
            example: 
              $ref: './examples/collection_post.json'
      responses:
        '201': 
          description: Successfully created a collection to manage indoor features.
          headers:
            Location:
              description: The URI of the newly created collection.
              schema:
                type: string
                example: "https://data.example.org/collections/tokyo_odaiba"
        '409':
          description: A collection with the specified Id already exists.
          content:
            application/json:
              schema:
                $ref: './schemas/ApiError.yml'
        '500': 
          $ref: './responses/InternalServerError.yml'
    get:
      summary: Retrieve catalogs of indoor feature collections
      description: |
        Retrieves the list of all feature collections.
        Indoor feature collections are notated "indoorfeature" in the `itemType` field of each collection.
      tags: 
      - IndoorFeatureCollection
      operationId: getCollections
      responses:
        '200':
          $ref: './responses/Collections.yml'
        '401':
          $ref: './responses/unauthorized.yml'
        '500':
          $ref: './responses/InternalServerError.yml'

  /collections/{collectionId}:
    parameters:
      - $ref: './parameters/collectionId.yml'
    get:
      summary: Access metadata about the collection
      description: |
        A user can access metadata with id `collectionId`.
      tags: 
        - IndoorFeatureCollection
      operationId: getCollection
      responses:
        '200':
          $ref: './responses/collection.yml'
        '401':
          $ref: './responses/unauthorized.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'
    patch:
      parameters:
        - $ref: './parameters/collectionId.yml'
      summary: Replace metadata about the collection
      description: |
        A user SHOULD replace metadata with `collectionId`.
        The request body schema is the same as the POST's.
        Only the `title` and `description` fields can be modified.
      tags:
        - IndoorFeatureCollection
      operationId: updateCollection
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: "New human-readable title for the collection."
                description:
                  type: string
                  description: "New description for the collection."
            example:
              title: "Updated Indoor Feature Collection Title"
              description: "This is the updated description for the indoor feature collection."
      responses:
        '200':
          $ref: './responses/collection.yml'
        '400':
          $ref: './responses/badRequest.yml'
        '401':
          $ref: './responses/unauthorized.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'
    delete:
      summary: Deletes a collection
      description: |
        The collection catalog with id 'collectionId' including metadata and indoor features SHOULD be deleted.
      tags: 
      - IndoorFeatureCollection
      operationId: deleteCollection
      responses:
        '204':
          $ref: './responses/noContent.yml'
        '401':
          $ref: './responses/unauthorized.yml'
        '403':
          $ref: './responses/forbidden.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'

  /collections/{collectionId}/items:
    parameters:
      - $ref: './parameters/collectionId.yml'
    post:
      summary: Insert indoor features
      description: |
        A user SHOULD insert a set of indoor features or an indoor feature into a collection with id `collectionId`.
        The request body schema SHALL follow the IndoorJSON schema.
        While the InterLayerConnection and Primal, Dual Spaces are not essential in a IndoorFeature's existence, it must have at least one ThematicLayer.
      tags: 
      - IndoorFeatures
      operationId: createItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './schemas/indoorJSON.yml'
      responses:
        '201': 
          description: Successfully created an indoorFeature into a specific collection.
        '400':
          $ref: './responses/badRequest.yml'
        '404':
          $ref: './responses/notFound.yml'
        '413':
          $ref: './responses/payloadTooLarge.yml'
        '422':
          description: Unprocessable Entity (Missing Required ThematicLayer).
          content:
            application/json:
              schema:
                $ref: './schemas/ApiError.yml'
        '500': 
          $ref: './responses/InternalServerError.yml'

    get:
      tags: [IndoorFeatures]
      summary: Retrieve indoor feature collection
      operationId: getIndoorFeatures
      parameters:
        - $ref: './parameters/collectionId.yml'
        - $ref: './parameters/limit.yml'
          bbox:
            name: bbox
            in: query
            required: false
            description: |-
              Only features that have a geometry that intersects the bounding box are selected. The bounding box is provided as four or six numbers, depending on whether the coordinate reference system includes a vertical axis (height or depth):
              Lower left corner, coordinate axis 1
              Lower left corner, coordinate axis 2
              Minimum value, coordinate axis 3 (optional)
              Upper right corner, coordinate axis 1
              Upper right corner, coordinate axis 2
              Maximum value, coordinate axis 3 (optional)
              If the value consists of four numbers, the coordinate reference system is WGS 84 longitude/latitude (http://www.opengis.net/def/crs/OGC/1.3/CRS84) unless a different coordinate reference system is specified in the parameter bbox-crs.

              If the value consists of six numbers, the coordinate reference system is WGS 84 longitude/latitude/ellipsoidal height (http://www.opengis.net/def/crs/OGC/0/CRS84h) unless a different coordinate reference system is specified in the parameter bbox-crs.

              The query parameter bbox-crs is specified in OGC API - Features - Part 2: Coordinate Reference Systems by Reference.

              For WGS 84 longitude/latitude the values are in most cases the sequence of minimum longitude, minimum latitude, maximum longitude and maximum latitude. However, in cases where the box spans the antimeridian the first value (west-most box edge) is larger than the third value (east-most box edge).

              If the vertical axis is included, the third and the sixth number are the bottom and the top of the 3-dimensional bounding box.

              If a feature has multiple spatial geometry properties, it is the decision of the server whether only a single spatial geometry property is used to determine the extent or all relevant geometries.
            schema:
              type: string
      responses:
        '200':
          $ref: './responses/features.yml'
        '404':
          description: A collection with the specified id was not found.
        '500':
          $ref: './responses/InternalServerError.yml'
  
  /collections/{collectionId}/items/{fId}:
    parameters:
      - $ref: './parameters/collectionId.yml'
      - $ref: './parameters/featureId.yml'
    get:
      tags:
        - IndoorFeatures
      summary: fetch a single indoor feature
      description: |-
        Retrieves a single IndoorFeature.

        **Logic:** If `bbox` and `level` are provided, the server returns an `IndoorFeature` with the primalSpace filtered. 
        If both are not provided, only the metadata within the properties is returned.
      operationId: getFeature
      parameters:
        - $ref: './parameters/bbox.yml'
        - $ref: './parameters/level.yml'
      responses:
        '200':
          description: Success. Returns a GeoJSON Feature representing the IndoorGML model.
          content:
            application/geo+json:
              schema:
                $ref: './schemas/featureGeoJSON.yml'
        '400':
          description: Bad Request (e.g., invalid bbox or level).
          content:
            application/json:
              schema:
                $ref: './schemas/ApiError.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/InternalServerError.yml'

    delete:
      tags:
        - IndoorFeatures
      summary: delete an indoor feature
      description: |-
        Permanently removes the specified indoor feature. 
        
        **Cascading Delete:** All associated ThematicLayers and InterLayerConnections 
        belonging to this feature ID will be removed.
      operationId: deleteFeature
      responses:
        '204':
          $ref: './responses/noContent.yml'
        '401':
          $ref: './responses/unauthorized.yml'
        '403':
          $ref: './responses/forbidden.yml'
        '404':
          $ref: './responses/notFound.yml'

  /collections/{collectionId}/items/{fId}/layers:
    parameters:
      - $ref: './parameters/collectionId.yml'
      - $ref: './parameters/featureId.yml'
    post:
      tags:
        - ThematicLayers
      summary: register a new thematic layer
      description: |-
        Uploads a new thematic layer (e.g., 'Pet-friendly' or 'Furnitures') to a specific `fId`.
        The body must conform to the IndoorJSON ThematicLayer schema.

        The `Id`s of the members in each primalSpace and dualSpace must be unique within the layer.
        Thus, a `cellSpace` can have the same `Id` as a `node` or `edge` even in the same ThematicLayer.
        (It is recommended to use a consistent naming convention to avoid confusion between them)
      operationId: createThematicLayer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './schemas/thematicLayer.yml'
      responses:
        '201':
          description: Success. The layer was validated and stored.
          headers:
            Location:
              description: URL to the newly created thematic layer.
              schema:
                type: string
        '400':
          $ref: './responses/badRequest.yml'
        '404':
          $ref: './responses/notFound.yml'
        '409':
          description: Conflict. A ThematicLayer with the same Id already exists within this IndoorFeature
          $ref: './schemas/ApiError.yml'
        '422':
          description: Unprocessable Entity (Non-unique Ids included).
          $ref: './schemas/ApiError.yml'


    get:
      tags:
        - ThematicLayers
      summary: retrieve all thematic layers
      description: |-
        Returns a summary list (metaData) of all (filtered) thematic layers within the specified indoor feature.
        Without the level parameter, it would show all the thematic layers.
      operationId: getThematicLayers
      parameters:
        - $ref: './parameters/limit.yml'
        - $ref: './parameters/theme.yml'
        - name: level
          in: query
          required: false
          description: |- 
            Returns all the thematicLayers that have at least one cellSpace on this level.
            applied to `CellSpace` geometries in this `tId` (e.g., '1F', 'B1').
          schema:
            type: string
            example: '1F'
      responses:
        '200':
          description: A JSON object containing level information and a list of thematicLayers including those level(s).
          content:
            application/json:
              schema:
                $ref: './schemas/ThematicLayerList.yml'
        '400':
          $ref: './responses/badRequest.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'
  
  /collections/{collectionId}/items/{fId}/interlayerconnections:
    parameters:
      - $ref: './parameters/collectionId.yml'
      - $ref: './parameters/featureId.yml'

    post:
      tags:
        - InterLayerConnections
      summary: create an inter-layer connection
      description: |-
        Creates a new inter-layer connection between two thematic layers within the same IndoorFeature.
        When connectedNodes and connectedCells are given simultaneously, the two cellSpaces and Nodes must have duality relationships.
        Also the given Ids should all be pre-existing.
      operationId: createInterLayerConnection
      requestBody:
        description: The InterLayerConnection object to be created.
        required: true
        content:
          application/json:
            schema:
              $ref: './schemas/interLayerConnection.yml'
      responses:
        '201':
          description: Created successfully.
        '400':
          description: Bad Request (Missing fields or array length != 2).
        '404':
          $ref: './responses/notFound.yml'
        '422':
          description: Unprocessable Entity (Logical ID mismatch).

    get:
      tags:
        - InterLayerConnections
      summary: retrieve inter-layer connections
      description: Returns all inter-layer connections, with optional filtering by layer or topological Expression.
      operationId: getInterLayerConnections
      parameters:
        - $ref: './parameters/connectedLayerId.yml'
        - $ref: './parameters/typeOfTopoExpression.yml'
        - $ref: './parameters/limit.yml'
      responses:
        '200':
          description: Successfully retrieved list of connection(s).
          content:
            application/json:
              schema:
                $ref: './schemas/interLayerConnections.yml'
        '400':
          $ref: './responses/badRequest.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'

  /collections/{collectionId}/items/{fId}/interlayerconnections/{cnId}:
    parameters:
      - $ref: './parameters/collectionId.yml'
      - $ref: './parameters/featureId.yml'
      - $ref: './parameters/cnId.yml'

    delete:
      tags:
        - InterLayerConnections
      summary: delete a specific inter-layer connection
      description: Deletes the specific inter-layer connection identified by connectionId.
      operationId: deleteInterLayerConnection
      responses:
        '204':
          description: No Content. The connection was successfully deleted.
        '401':
          $ref: './responses/unauthorized.yml'
        '403':
          $ref: './responses/forbidden.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'

  /collections/{collectionId}/items/{fId}/layers/{tId}:
    parameters:
          - $ref: './parameters/collectionId.yml'
          - $ref: './parameters/featureId.yml'
          - $ref: './parameters/tId.yml'
    get:
      tags:
        - ThematicLayers
      summary: Retrieve a specific thematic layer
      description: >-
        Returns metadata summary if no filters are provided. 
        Returns full Primal/Dual features if 'level' or 'bbox' is present.

        As the property 'level' is only available for `cellSpaces`, for `cellBoundaries` they will be inferred through `boundedBy`.
        The 'dualSpace' will be returned non-filtered.
      operationId: getThematicLayer
      parameters:
        - $ref: './parameters/level.yml'
        - $ref: './parameters/bbox.yml'
      responses:
        '200':
          description: Successfully retrieved a single thematic layer.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: './schemas/thematicLayerSummary.yml'
                  - $ref: './schemas/thematicLayer.yml'
        '400':
          $ref: './responses/badRequest.yml'
        '401':
          $ref: './responses/unauthorized.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'

    delete:
      tags:
        - ThematicLayers
      summary: Delete a thematic layer
      description: >-
        Permanently removes the layer and all its internal elements. 
        Automatically cleans up any `InterLayerConnections` pointing to this layer to prevent broken links.
      operationId: deleteThematicLayer
      responses:
        '204':
          $ref: './responses/noContent.yml'
        '401':
          $ref: './responses/unauthorized.yml'
        '403':
          $ref: './responses/forbidden.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'

  /collections/{collectionId}/items/{fId}/layers/{tId}/primal:
    parameters:
      - $ref: './parameters/collectionId.yml'
      - $ref: './parameters/featureId.yml'
      - $ref: './parameters/tId.yml'

    get:
      tags:
        - PrimalSpaceLayer
      summary: retrieve primal space members
      description: |-
        Retrieves a collection of CellSpaces and CellBoundaries within a specific thematic layer. 
        Supports spatial filtering via `bbox`, `level` and logical filtering via `poi`/`isVirtual`.
      operationId: getPrimalSpace
      parameters:
        - $ref: './parameters/bbox.yml'
        - $ref: './parameters/level.yml'
        - $ref: './parameters/poi.yml'
        - $ref: './parameters/isVirtual.yml'
        - $ref: './parameters/cellSpaceName.yml'
      responses:
        '200':
          description: Success. Returns the PrimalSpaceLayer.
          content:
            application/json:
              schema:
                $ref: './schemas/primalSpaceLayer.yml'
        '400':
          $ref: './responses/badRequest.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'

    post:
      tags:
        - PrimalSpaceLayer
      summary: create primal space member
      description: |-
        Create a new `cellSpace` or `cellBoundary`.
        
        **Constraints:**
        - If a `duality` is provided for a `cellBoundary`, the referenced `edge` must already exist and must not already be linked to another feature.
        - A `cellSpace` cannot have a `duality` link at the moment of creation, as a `node` cannot exist independently without its parent graph.
        
        **Automatic Updates:**
        - When a `node` is later created with a `duality` link to an existing `cellSpace`, the system automatically updates the `cellSpace` record to reflect this bidirectional relationship.
        - Vice versa, the `edge` record is also updated to include the `cellBoundary` as its duality.
      operationId: createPrimalMember
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: './schemas/cellSpace.yml'
                - $ref: './schemas/cellBoundary.yml'
      responses:
        '201':
          description: Created successfully.
        '400':
          $ref: './responses/badRequest.yml'
        '409':
          description: Conflict. Duality link already exists for that duality reference.
        '500':
          $ref: './responses/internalServerError.yml'

  /collections/{collectionId}/items/{fId}/layers/{tId}/dual:
    parameters:
      - $ref: './parameters/collectionId.yml'
      - $ref: './parameters/featureId.yml'
      - $ref: './parameters/tId.yml'

    post:
      tags:
        - DualSpaceLayer
      summary: create a dual space member (Node or Edge)
      description: |-
        Registers a new Node or Edge. 

        **Strict Duality Requirement:** A Node can only be created if the corresponding CellSpace (duality) exists. 
        An Edge connects exactly 2 nodes.
      operationId: createDualMember
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: './schemas/node.yml'
                - $ref: './schemas/edge.yml'
      responses:
        '201':
          description: Created successfully.
        '400':
          $ref: './responses/badRequest.yml'
        '401':
          $ref: './responses/unauthorized.yml'
        '404':
          $ref: './responses/notFound.yml'
        '409':
          description: this edgeId or nodeId already exists in this indoorFeature.
        '422':
          description: Unprocessable Entity (Node missing duality dependency).
        '500':
          $ref: './responses/internalServerError.yml'

    get:
      tags:
        - DualSpaceLayer
      summary: Retrieve all nodes and edges (Navigation Network)
      description: |-
        Retrieves the dual space layer, optionally filtered by edge weights for pathfinding.
        When filtered by weights, the response includes not only the regarding edges, but also only the connected nodes to those edges.
      operationId: getDualSpace
      parameters:
        - $ref: './parameters/collectionId.yml'
        - $ref: './parameters/featureId.yml'
        - $ref: './parameters/tId.yml'
        - name: minWeight
          in: query
          schema: { type: number, minimum: 0 }
          description: Filter edges where weight > minWeight.
        - name: maxWeight
          in: query
          schema: { type: number, minimum: 0 }
          description: Filter edges where weight < maxWeight.
      responses:
        '200':
          description: Returns the DualSpaceLayer.
          content:
            application/json:
              schema:
                $ref: './schemas/dualSpaceLayer.yml'
        '400':
          $ref: './responses/badRequest.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'

  # /collections/{collectionId}/items/{fId}/layers/{tId}/geoquery:
  #   parameters:
  #     - $ref: './parameters/collectionId.yml'
  #     - $ref: './parameters/featureId.yml'
  #     - $ref: './parameters/tId.yml'
  #   get:
  #     tags:
  #         - Services
  #     summary: Performs a geometric query agains CellSpace geometries
  #     description: Performs a 2D geometric predicate query against CellSpace geometries within a specified indoor level.
  #     operationId: geometricQuery
  #     parameters:
  #       - $ref: './parameters/op.yml'
  #       - $ref: './parameters/level.yml'
  #       - $ref: './parameters/geometry.yml'
  #       - $ref: './parameters/limit.yml'
  #     responses:
  #       '200':
  #         description: Returns the GeoQueryResults.
  #         content:
  #           application/json:
  #             schema:
  #               $ref: '#/components/schemas/GeoQueryResults'
  #       '404':
  #         description: Invalid path parameter.

  # /collections/{collectionId}/items/{fId}/layers/{tId}/dual/route:
  #   parameters:
  #     - $ref: './parameters/collectionId.yml'
  #     - $ref: './parameters/featureId.yml'
  #     - $ref: './parameters/tId.yml'
  #   get:
  #     tags:
  #       - Services
  #     summary: Compute an indoor route using the dual graph
  #     description: Computes a navigable route between two nodes within an IndoorFeature using the dual graph of the specified thematic layer.
  #     operationId: computeIndoorRoute
  #     parameters:
  #       - $ref: './parameters/sn.yml'
  #       - $ref: './parameters/dn.yml'
  #     responses:
  #       '200':
  #         description: Returns the RouteResults.
  #         content:
  #           application/json:
  #             schema:
  #               $ref: '#/components/schemas/RouteResults'
  #       '404':
  #         description: Invalid path parameter.

  /collections/{collectionId}/items/{fId}/layers/{tId}/primal/{mId}:
    parameters:
      - $ref: './parameters/collectionId.yml'
      - $ref: './parameters/featureId.yml'
      - $ref: './parameters/tId.yml'
      - $ref: './parameters/mId.yml'

    get:
      tags:
        - PrimalSpaceLayer
      summary: retrieve a specific cell space
      description: |-
        Returns the full representation of a primalSpaceMember.
        If the `mId` refers to a `cellSpace`, it returns the whole cellSpace.
        If the `mId` refers to a `cellBoundary`, it returns the whole cellBoundary.
      operationId: getPrimalMember
      responses:
        '200':
          description: Success. Returns the CellSpace or CellBoundary object.
          content:
            application/json:
              schema:
                $ref: './schemas/cellSpace.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'

    patch:
      tags:
        - PrimalSpaceLayer
      summary: update cell space metadata
      description: |-
        Performs a partial update. Only include the fields you wish to change (cellSpaceName, level, or poi).
      operationId: patchCellSpace
      requestBody:
        content:
          application/merge-patch+json:
            schema:
              $ref: './schemas/cellSpaceUpdate.yml'
      responses:
        '200':
          description: Success. Returns the updated CellSpace.
          content:
            application/json:
              schema:
                $ref: './schemas/cellSpace.yml'
        '400':
          $ref: './responses/badRequest.yml'
        '401':
          $ref: './responses/unauthorized.yml'
        '403':
          $ref: './responses/forbidden.yml'
        '404':
          $ref: './responses/notFound.yml'
        '422':
          description: Unprocessable Entity. Attempted to modify restricted fields.

    delete:
      tags:
        - PrimalSpaceLayer
      summary: delete a cell space
      description: |-
        Permanently removes the CellSpace. 
        **Cleanup:** This triggers a cascading delete of the associated DualSpace Node and invalidates connected Edges.
        Also DELETES the `interLayerConnection`(s) referencing the deleted `primalSpaceMember`.
      operationId: deleteCellSpace
      responses:
        '204':
          description: Deleted successfully.
        '400':
          $ref: './responses/badRequest.yml'
        '401':
          $ref: './responses/unauthorized.yml'
        '403':
          $ref: './responses/forbidden.yml'
        '404':
          $ref: './responses/notFound.yml'
        '500':
          $ref: './responses/internalServerError.yml'

  /collections/{collectionId}/items/{fId}/layers/{tId}/primal/{mId}/bounding:
    parameters:
        - $ref: './parameters/collectionId.yml'
        - $ref: './parameters/featureId.yml'
        - $ref: './parameters/tId.yml'
        - $ref: './parameters/mId.yml'
    get:
      tags:
        - Services
      summary: Retrieve a list of CellSpaces bounded by a specific CellBoundary
      description: |-
        Returns the set of CellSpaces bounded by a given CellBoundary in the primal space
      operationId: getBoundingCellSpaces
      responses:
        '200':
          description: Success. Returns the requested a list of CellSpaces.
          content:
            application/json:
              schema:
                $ref: './schemas/cellSpace.yml'
        '404':
          description: CellBoundary not found.
        '500':
          $ref: './responses/InternalServerError.yml'

  /collections/{collectionId}/items/{fId}/layers/{tId}/dual/{mId}/connected:
    parameters:
      - $ref: './parameters/collectionId.yml'
      - $ref: './parameters/featureId.yml'
      - $ref: './parameters/tId.yml'
      - $ref: './parameters/mId.yml'

    get:
      tags:
        - Services
      summary: Retrieve  connectively reachable nodes and their duality cellspaces from specific node.
      description: |-
        Returns nodes and their associated cell spaces that are connectively reachable from the given node within the indoor dual graph.
      operationId: getConnectedNodes
      parameters:
        - $ref: './parameters/limit.yml'
        - $ref: './parameters/hop.yml'
      responses:
        '200':
          description: Successfully retrieved the Node and CellSpaces.
          content:
            application/json:
              schema:
                $ref: './schemas/connectedResults.yml'
        '404':
          description: Node ID not found in this thematic layer.
        '500':
          $ref: './responses/InternalServerError.yml'     

  /collections/{collectionId}/items/{fId}/layers/{tId}/dual/{mId}:
    parameters:
      - $ref: './parameters/collectionId.yml'
      - $ref: './parameters/featureId.yml'
      - $ref: './parameters/tId.yml'
      - $ref: './parameters/mId.yml'

    get:
      tags:
        - DualSpaceLayer
      summary: Get a specific Edge
      description: |-
        Retrieves a single Edge from the Dual Space. 
        An Edge represents the topological adjacency/connectivity between two States (Nodes). 
        **Dependency Logic:** Includes a `duality` link to the corresponding CellBoundary in the Primal Space.
      operationId: getEdge
      responses:
        '200':
          description: Success. Returns the requested Edge.
          content:
            application/json:
              schema:
                $ref: './schemas/edge.yml'
        '404':
          description: Edge not found.
        '400':
          description: Invalid ID supplied.
        '500':
          $ref: './responses/InternalServerError.yml'

    patch:
      tags:
        - DualSpaceLayer
      summary: update edge weight
      operationId: patchEdge
      requestBody:
        required: true
        content:
          application/merge-patch+json:
            schema:
              $ref: './schemas/edgeWeightUpdate.yml'
      responses:
        '200':
          description: Successfully updated the edge weight.
          content:
            application/json:
              schema:
                $ref: './schemas/edge.yml'
        '400':
          description: Bad Request (e.g., invalid weight value).
        '404':
          description: Edge ID not found.
        '500':
          $ref: './responses/InternalServerError.yml'

    delete:
      tags:
        - DualSpaceLayer
      summary: delete a specific edge
      description: |-
        Permanently removes the edge from the navigation network.
        **Dependency Logic:** The server must update the `connects` array of the two Nodes previously linked by this edge to remove the reference.
      operationId: deleteEdge
      responses:
        '204':
          description: Successfully deleted.
        '404':
          description: Edge ID not found.
        '500':
          $ref: './responses/InternalServerError.yml'